<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>小牛写代码的地方</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="小牛写代码的地方">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="小牛写代码的地方">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Cattle">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="小牛写代码的地方" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小牛写代码的地方</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Code is Poetry</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/03/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-03-03T05:54:01.725Z" itemprop="datePublished">2021-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/03/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/03/hello-world/" data-id="cklt0yx5l0006h4ss5rc36hzq" data-title="Hello World" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-用纯CSS实现镂空效果" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/22/%E7%94%A8%E7%BA%AFCSS%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C/" class="article-date">
  <time class="dt-published" datetime="2019-02-22T15:20:51.000Z" itemprop="datePublished">2019-02-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/22/%E7%94%A8%E7%BA%AFCSS%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C/">用纯 CSS 实现镂空效果</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>UPDATE 2/26</p>
<p>现在为示例 CodePen 添加了厂商前缀，并在正文中添加了兼容性提示。感谢评论区的各位。</p>
</blockquote>
<p>近来研究了一下镂空效果。</p>
<!--`https://github.githubassets.com/pinned-octocat.svg`-->
<h1 id="background-clip-text"><a href="#background-clip-text" class="headerlink" title="background-clip: text"></a><code>background-clip: text</code></h1><p>背景被裁剪为文字的前景色。第一次是在 CSS-Tricks 看到的这个用法: 在 CSS-Tricks 网站上，这个玩意用得到处都是。</p>
<p>这样，做简单的图片背景镂空效果便不再困难了。关键代码只有几行。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;/path/to/your/image&quot;</span>);</span><br><span class="line">  -webkit-<span class="attribute">background-clip</span>: text;  <span class="comment">/* Chrome 用户注意加 -webkit 前缀 */</span></span><br><span class="line">  <span class="attribute">background-clip</span>: text;</span><br><span class="line">  <span class="attribute">color</span>: transparent;             <span class="comment">/* 文字设为透明 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就这几行，视觉上会就会有大变化。<a target="_blank" rel="noopener" href="https://codepen.io/xuxinhang/pen/ZwdxgW">前后对比</a>：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915c2a03989856?w=835&amp;h=277&amp;f=png&amp;s=237345" alt=""></p>
<blockquote>
<p>另外，<a target="_blank" rel="noopener" href="https://codepen.io/xuxinhang/pen/wNGwYo">这里</a>有个比上面更实用的 Demo</p>
</blockquote>
<blockquote>
<p><strong>兼容性提示</strong></p>
<p>除了 Firefox 和 Edge ，其它浏览器需要配合厂商前缀：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-webkit-<span class="attribute">background-clip</span>: text;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><code>background-clip</code> 既然是“background”家族的，那它天生和图片、渐变打的交道多。不过，我们做镂空总不会都是图片、渐变这种吧。如果我们想做视频、文字，甚至更复杂的 DOM 元素的镂空效果呢？</p>
<h1 id="单刀直入：-CSS-mask-属性"><a href="#单刀直入：-CSS-mask-属性" class="headerlink" title="单刀直入： CSS mask 属性"></a>单刀直入： CSS <code>mask</code> 属性</h1><p>这应该是最直接能想到的方法了。毕竟名字里就带个“mask”，谁能忽略呢？</p>
<p>CSS <code>mask-*</code> 系列属性是在 CSS Masking Module Level 1 中定义的。这个规范也定义了为很多人熟知的 <code>clip</code> 和 <code>clip-path</code> 属性，换句话说，这个CSS 模块包括遮罩和剪裁两部分。</p>
<h2 id="第一个例子"><a href="#第一个例子" class="headerlink" title="第一个例子"></a>第一个例子</h2><p>虽然是一个新的属性，但设置 mask 属性并不难。下面就是我们的第一个例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;masked&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.masked</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(red, orange, yellow, lightgreen, blue, purple, red);</span><br><span class="line">  -webkit-<span class="attribute">mask</span>: <span class="built_in">url</span>(<span class="string">&quot;https://github.githubassets.com/pinned-octocat.svg&quot;</span>);</span><br><span class="line">  <span class="attribute">mask</span>: <span class="built_in">url</span>(<span class="string">&quot;https://github.githubassets.com/pinned-octocat.svg&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就是下面的效果啦。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915c7824565c9e?w=199&amp;h=191&amp;f=png&amp;s=6203" alt=""></p>
<p>上面的用法还是很简单的，我们指定了一个 <code>mask</code> 参数，它的值是一张<s>从GitHub盗的</s>SVG图片。于是多彩的渐变就被<s>裁剪</s>遮罩成了那只著名的猫。</p>
<blockquote>
<p> <strong>兼容性提示</strong></p>
<p>目前 Mask Module 还处于 Candidate Recommendation 状态，不少浏览器现在需要厂商前缀。Chrome 用户和 Edge 用户请加上 <code>-webkit</code> 前缀，如 <code>-webkit-mask: ... ;</code>。Firefox 可直接使用。</p>
<p><a target="_blank" rel="noopener" href="https://caniuse.com/#search=mask">从Can I Use 可以知道</a>，加上 <code>-webkit</code>，支持 Mask 的浏览器还是不少的。</p>
<p>为了方便阅读，<em>下面的代码 <strong>均未</strong> 使用前缀</em>。</p>
</blockquote>
<h2 id="mask-大家族"><a href="#mask-大家族" class="headerlink" title="mask-* 大家族"></a>mask-* 大家族</h2><p><code>mask</code>属性实际上是诸多<code>mask-*</code>的缩写:</p>
<pre><code>mask-image
mask-repeat
mask-position
mask-clip
mask-origin
mask-size
-
mask-type
mask-composite
mask-mode
</code></pre><p>有没有 <code>background-*</code> 的即视感？没错，里面的不少属性都是和 backgorund / border 一致的，而且它们的作用也是一致的，只不过 <code>background-*</code> 用在背景上，而 <code>mask-*</code> 用在遮罩层上而已——用在背景上的奇技淫巧搬到 mask 的世界里还能接着用！比如实现这样的效果：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915c51b6c3daab?w=183&amp;h=200&amp;f=png&amp;s=6726" alt=""></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.masked</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: /* ... */;</span><br><span class="line">  <span class="attribute">width</span>: /* ... */;</span><br><span class="line">  <span class="attribute">background</span>: /* ... */;</span><br><span class="line">  <span class="comment">/* Webkit 内核用户请注意添加厂商前缀 -webkit */</span></span><br><span class="line">  <span class="attribute">mask</span>-image: <span class="built_in">url</span>(<span class="string">https://github.githubassets.com/pinned-octocat.svg</span>);</span><br><span class="line">  <span class="attribute">mask</span>-size: <span class="number">5em</span>;</span><br><span class="line">  <span class="attribute">mask</span>-<span class="attribute">position</span>: center;</span><br><span class="line">  <span class="comment">/* 如果你心情好，加个动画也没问题的 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="进一步控制遮罩效果"><a href="#进一步控制遮罩效果" class="headerlink" title="进一步控制遮罩效果"></a>进一步控制遮罩效果</h2><p>可能读者已经发现了，<code>mask-*</code> 家族里有几张生面孔。这也好理解： mask 这么强大的特性，完完全全地抄 <code>background-*</code> 岂不可惜了。</p>
<h3 id="mask-mode"><a href="#mask-mode" class="headerlink" title="mask-mode"></a><code>mask-mode</code></h3><p>mask-mode 用来指定具体的遮罩方式。</p>
<blockquote>
<p><strong>兼容性预警</strong>：目前 <code>mask-mode</code> 仅 Firefox 53+ 支持。</p>
</blockquote>
<p>mask-type CSS 属性设置 <code>mask-image</code> 被用于“亮度型”的遮罩还是“不透明度”型的遮罩。<code>mask-mode: alaph</code> 表示使用不透明度（即alaph通道）作为 mask value，<code>mask-mode: luminance</code> 表示使用亮度值作为 mask value。</p>
<p>那，遮罩值 / mask value 又是什么？mask value 表示被遮罩的元素被遮罩的程度。mask value 越大，被遮罩区域会更偏向于显露，mask value 最大的时候，那个区域就完全不透明了。举个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mode&quot;</span>&gt;</span>ABCDEFG<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mode</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="comment">/* and more */</span></span><br><span class="line">  <span class="attribute">mask</span>-image: <span class="built_in">linear-gradient</span>(to left, black, yellow);</span><br><span class="line">  <span class="attribute">mask</span>-mode: luminance; <span class="comment">/* or alaph ? */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915cc34f589f22?w=912&amp;h=114&amp;f=png&amp;s=15270" alt=""></p>
<p>左边是遮罩图片，中间是 <code>luminance</code> 右边使用 <code>alaph</code>。这里的图片是不透明的，所以将一个恒不透明的图片在<code>alaph</code>模式下作为遮罩，其结果是没有遮罩效果。但是图片是有亮度变化的，所以<code>luminance</code>下的被遮罩元素就呈现出透明度的变化了。 </p>
<p>一般 <code>luminance</code> 模式慢一点点，因为每一个像素点的亮度值需要根据 RGB 三个通道的值计算出来。</p>
<h3 id="mask-composite"><a href="#mask-composite" class="headerlink" title="mask-composite"></a><code>mask-composite</code></h3><p>指定当有多个遮罩图片叠加起来的时候，如何处理遮罩效果。一些属性值的效果依赖于 mask-image 的层级次序。</p>
<p>用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/mask-composite#Example">MDN 提供的这个 CodePen</a> 来感受一下 </p>
<p>关于 <code>mask</code> 的知识就讲到这里，更具体更准确的说明还是<em>要到 MDN 看一看</em>。</p>
<h1 id="混合模式"><a href="#混合模式" class="headerlink" title="混合模式"></a>混合模式</h1><p>这应该是最为神奇的一种方法了。使用PS的时候，经常会看见“混合模式”这个词。还记得多年前我初次使用 Photoshop 的时候还很好奇“混合模式”是什么东西，顿时让我对 Photoshop 充满了敬畏之情。不过，当年的敬畏归敬畏，现在这里说的“混合模式”还是蛮好理解的。</p>
<p>所谓的“混合模式”，是指当一种当层重叠时计算像素最终颜色值的方法。每种混合模式接收前景颜色值和背景颜色值（分别为顶部颜色和底部颜色）作为输入，执行一些计算并输出最后要显示在屏幕上的颜色值。最终的可见的颜色是对层中的每个重叠像素执行混合模式计算所得的结果。<strong>说白了，混合模式确定了把一层叠加到另一层上去会得到什么结果。</strong></p>
<p>在 CSS 中，可以使用 <code>mix-blend-mode</code> 来指定混合模式。</p>
<p>你可能会问了，平时也没有用什么“混合模式”这种东西，所以<code>blend-mode</code>的默认值是<code>none</code>吗？可不是。其实，这种最常见的 上层把下层“遮住”了的情况也属于一种混合模式，叫<code>normal</code>，它本质上是一种只保留前景颜色值而完全抛弃背景颜色值的混合模式。</p>
<p>这里我们只讨论实现镂空效果用到的混合模式 —— <code>screen</code>。这种混合模式有一个特性，前景层是黑色导致最终可见的颜色直接是背景层的颜色，前景层是白色导致最终可见的颜色直接是白色。</p>
<p>相信你已经搞不明白这和镂空有什么关系了，下面举个例子看一下。</p>
<p>现在，我们有一个<code>&lt;video&gt;</code>，以及一个“白底黑字”的Logo浮层。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915a8b25d771d1?w=640&amp;h=360&amp;f=png&amp;s=170232" alt=""></p>
<p>我们在浮层框上加上下面的 CSS：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="comment">/* ... ... */</span></span><br><span class="line">    mix-blend-mode: screen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就变成了下面的样子：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/2/22/16915ae4bf83ad55?w=640&amp;h=362&amp;f=png&amp;s=215599" alt=""><br><a target="_blank" rel="noopener" href="https://codepen.io/xuxinhang/pen/KJjBbP">去这个 Demo，看具体代码和效果</a></p>
<p>齿轮图标确实是变为镂空的了。不过，为什么呢？</p>
<p>先来明确一件事：把浮层置于视频之上，浮层是“前景”，视频是“背景”。先来看浮层的白色部分，因为把白色置于任何颜色之上都得到白色，所以白色部分被保留；而因为黑色置于任何颜色之上都得到下层的颜色，所以黑色部分呈现镂空效果。</p>
<p>但是这样的实现比较 Hack，因为这里只使用了黑白两色，如果使用其它的颜色作为浮层的 <code>background-color</code>，得到的就不会像是镂空的效果了，这时还是得请上面的<code>mask</code>家族出场。不过，单单对于白底的情况，<code>mix-blend-mode</code> 不失为一个可行的解法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/22/%E7%94%A8%E7%BA%AFCSS%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C/" data-id="cklt0yx5r000eh4ss5r9q3o9y" data-title="用纯 CSS 实现镂空效果" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blend-mode/" rel="tag">blend mode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mask/" rel="tag">mask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/" rel="tag">混合模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%95%82%E7%A9%BA/" rel="tag">镂空</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-剖析-HTTPS-的设计思路" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/01/11/%E5%89%96%E6%9E%90-HTTPS-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/" class="article-date">
  <time class="dt-published" datetime="2019-01-11T15:13:38.000Z" itemprop="datePublished">2019-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/01/11/%E5%89%96%E6%9E%90-HTTPS-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">剖析 HTTPS 的设计思路</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer ，安全的超文本传输协议），是以安全为目标的HTTP通道。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。这个系统的最初研发由 Netscape 进行。</p>
<p>如今，HTTPS 已经渐渐成为主流，很多大型网站都已经全站 HTTPS 化。那么有了 HTTP 后为什么还需要有 HTTPS 呢？——为了解决 HTTP 的不足。</p>
        
          <p class="article-more-link">
            <a href="/2019/01/11/%E5%89%96%E6%9E%90-HTTPS-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/01/11/%E5%89%96%E6%9E%90-HTTPS-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/" data-id="cklt0yx5n000ah4ss84cxfyoo" data-title="剖析 HTTPS 的设计思路" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Pro-Git-Reading-Note-Part-II" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/18/Pro-Git-Reading-Note-Part-II/" class="article-date">
  <time class="dt-published" datetime="2018-11-18T05:15:57.000Z" itemprop="datePublished">2018-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/18/Pro-Git-Reading-Note-Part-II/">Pro Git Reading Note Part II</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Git-Guide"><a href="#Git-Guide" class="headerlink" title="Git Guide"></a>Git Guide</h1><h2 id="7-2-Git-工具-交互式暂存"><a href="#7-2-Git-工具-交互式暂存" class="headerlink" title="7.2 Git 工具 - 交互式暂存"></a>7.2 Git 工具 - 交互式暂存</h2><p>text-rendering<br>/<em> Keyword values </em>/<br>text-rendering: auto;<br>text-rendering: optimizeSpeed;<br>text-rendering: optimizeLegibility;<br>text-rendering: geometricPrecision;</p>
<h2 id="7-14-Git-工具-凭证存储"><a href="#7-14-Git-工具-凭证存储" class="headerlink" title="7.14 Git 工具 - 凭证存储"></a>7.14 Git 工具 - 凭证存储</h2><h4 id="Git-凭证存储"><a href="#Git-凭证存储" class="headerlink" title="Git 凭证存储"></a>Git 凭证存储</h4><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#36; git config --global credential.helper cache</span><br></pre></td></tr></table></figure>
<ul>
<li>default</li>
<li>cache</li>
<li>store</li>
<li>osxkeychain</li>
<li>winstore</li>
</ul>
<p>Git 甚至允许<strong>你配置多个辅助工具</strong>。 当查找特定服务器的凭证时，Git 会按顺序查询，并且<strong>在找到第一个回答时停止查询</strong>。 当保存凭证时，Git 会将用户名和密码发送给 <strong>所有</strong> 配置列表中的辅助工具，它们会按自己的方式处理用户名和密码。 如果你在闪存上有一个凭证文件，但又希望在该闪存被拔出的情况下使用内存缓存来保存用户名密码，<code>.gitconfig</code> 配置文件如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[credential]</span></span><br><span class="line">    <span class="attr">helper</span> = store --file /mnt/thumbdrive/.git-credentials</span><br><span class="line">    <span class="attr">helper</span> = cache --timeout <span class="number">30000</span></span><br></pre></td></tr></table></figure>
<ul>
<li>也可自己写一个认证程序 *</li>
<li>正如你看到的，扩展这个系统是相当简单的！</li>
</ul>
<p>当你碰到问题时，你应该可以很容易找出是哪个分支在什么时候由谁引入了它们。 如果你想在项目中使用子项目，你也已经知道如何来满足这些需求。 到此，<strong>你应该能毫无压力地在命令行中使用 Git 来完成日常中的大部分事情</strong>。</p>
<h2 id="8-1-自定义-Git-配置-Git"><a href="#8-1-自定义-Git-配置-Git" class="headerlink" title="8.1 自定义 Git - 配置 Git"></a>8.1 自定义 Git - 配置 Git</h2><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#36; git config --global core.editor emacs</span><br></pre></td></tr></table></figure>
<ul>
<li>:heart:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#36; git config --global commit.template ~&#x2F;.gitmessage.txt</span><br></pre></td></tr></table></figure></li>
<li><p>全局排除 :heart:<br> <code>git config --global core.excludesfile ~/.gitignore_global</code></p>
<blockquote>
<p><code>core.excludesFile</code><br> Specifies the pathname to the file that contains patterns to describe paths that are not meant to be tracked, in addition to .gitignore (per-directory) and .git/info/exclude. Defaults to &#36;XDG_CONFIG_HOME/git/ignore. If &#36;XDG_CONFIG_HOME is either not set or empty, &#36;HOME/.config/git/ignore is used instead. See gitignore[5].</p>
</blockquote>
</li>
<li><p>如果你把 <code>help.autocorrect</code> 设置成 1，那么只要有一个命令被模糊匹配到了，Git 会自动运行该命令。</p>
</li>
</ul>
<h5 id="外部的合并与比较工具"><a href="#外部的合并与比较工具" class="headerlink" title="外部的合并与比较工具"></a>外部的合并与比较工具</h5><ul>
<li><p><code>git mergetool --tool=&lt;tool&gt;&lt;/tool&gt;</code></p>
<blockquote>
<p>-t <tool></tool></p>
<p>–tool=<tool></tool></p>
<p>Use the merge resolution program specified by <tool></tool>. <u>Valid values include emerge, gvimdiff, kdiff3, meld, vimdiff, and tortoisemerge. Run <code>git mergetool --tool-help</code> for the list of valid <tool></tool> settings.</u></p>
<p><u>If a merge resolution program is not specified, <em>git mergetool</em> will use the configuration variable<code>merge.tool</code></u>. If the configuration variable <code>merge.tool</code> is not set, <em>git mergetool</em> will pick a suitable default.</p>
</blockquote>
</li>
<li><p><code>diff.external</code></p>
<blockquote>
<p>If this config variable is set, diff generation is not performed using the internal diff machinery, but using the given command. Can be overridden with the ‘GIT_EXTERNAL_DIFF’ environment variable.</p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/18/Pro-Git-Reading-Note-Part-II/" data-id="cklt0yx5j0004h4ss7jgh3pl7" data-title="Pro Git Reading Note Part II" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Pro-Git-Reading-Note-Part-I" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/10/18/Pro-Git-Reading-Note-Part-I/" class="article-date">
  <time class="dt-published" datetime="2018-10-18T05:13:12.000Z" itemprop="datePublished">2018-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/10/18/Pro-Git-Reading-Note-Part-I/">Pro Git Reading Note Part I</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- <div class="ql-editor" data-gramm="false" contenteditable="true">  -->
<p><code>git remote show</code></p>
<p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">为这种情况下的合并操作没有需要解决的分歧——这就叫做 “快进（fast-forward）”</span></p>
<p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">Git 自动将 </span><code>serverfix</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 分支名字展开为</span><code>refs/heads/serverfix:refs/heads/serverfix</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">，那意味着，“推送本地的 serverfix 分支来更新远程仓库上的 serverfix 分支。” 我们将会详细学习 </span><a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2/ch00/ch10-git-internals">Git 内部原理</a><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 的 </span><code>refs/heads/</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 部分，但是现在可以先把它放在儿。 你也可以运行 </span><code>gi</code></p>
<h1 id="3-5-Git-分支-远程分支"><a href="#3-5-Git-分支-远程分支" class="headerlink" title="3.5 Git 分支 - 远程分支"></a>3.5 Git 分支 - 远程分支</h1><h3 id="跟踪分支"><a href="#跟踪分支" class="headerlink" title="跟踪分支"></a><strong>跟踪分支</strong></h3><p>从一个远程跟踪分支检出一个本地分支会自动创建一个叫做 “跟踪分支”（有时候也叫做 “上游分支”）。 跟踪分支是与远程分支有直接关系的本地分支。 如果在一个跟踪分支上输入 <code>git pull</code>，Git 能自动地识别去哪个服务器上抓取、合并到哪个分支。</p>
<p>当克隆一个仓库时，它通常会自动地创建一个跟踪 origin/master 的 master 分支。 然而，如果你愿意的话可以设置其他的跟踪分支 - 其他远程仓库上的跟踪分支，或者不跟踪 master 分支。 最简单的就是之前看到的例子，运行 git checkout -b [branch] [remotename]/[branch]。 这是一个十分常用的操作所以 Git 提供了 –track 快捷方式：</p>
<pre spellcheck="false">$ git checkout --track origin/serverfix       
</pre>

<p><a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF</a></p>
<p>clone下来的repo在本地默认只有master分支。</p>
<p>上游快捷方式</p>
<p><span style="background-color: rgb(255, 242, 133);">当设置好跟踪分支后，可以通过 </span><code>@&#123;upstream&#125;</code><span style="background-color: rgb(255, 242, 133);"> 或 </span><code>@&#123;u&#125;</code><span style="background-color: rgb(255, 242, 133);"> 快捷方式来引用它</span>。 所以在 <code>master</code> 分支时并且它正在跟踪 <code>origin/master</code> 时，如果愿意的话可以使用 <code>git merge @&#123;u&#125;</code> 来取代 <code>git merge origin/master</code>。</p>
<h3 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a><strong>删除远程分支</strong></h3><pre spellcheck="false">git push origin --delete serverfix          
</pre>

<h1 id="3-6-Git-分支-变基"><a href="#3-6-Git-分支-变基" class="headerlink" title="3.6 Git 分支 - 变基"></a>3.6 Git 分支 - 变基</h1><pre spellcheck="false"> git rebase --onto master server client          
</pre>

<ul>
<li><span style="background-color: rgb(255, 242, 133);">如果不加 onto 会发生什么？</span></li>
<li>好好研究一下 rebase 的 options</li>
</ul>
<pre spellcheck="false">git rebase [-i | --interactive] [&lt;options&gt;] [--exec &lt;cmd&gt;] [--onto &lt;newbase&gt;]  [&lt;upstream&gt; [&lt;branch&gt;]] git rebase [-i | --interactive] [&lt;options&gt;] [--exec &lt;cmd&gt;] [--onto &lt;newbase&gt;]  --root [&lt;branch&gt;] git rebase --continue | --skip | --abort | --quit | --edit-todo | --show-current-patch          
</pre>

<h3 id="用变基解决变基"><a href="#用变基解决变基" class="headerlink" title="用变基解决变基"></a><strong>用变基解决变基</strong></h3><p>如果你 <strong>真的</strong> 遭遇了类似的处境，Git 还有一些高级魔法可以帮到你。 如果团队中的某人强制推送并覆盖了一些你所基于的提交，你需要做的就是检查你做了哪些修改，以及他们覆盖了哪些修改。<span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">如果你或你的同事在某些情形下决意要这么做，请一定要通知每个人执行 </span><code>git pull --rebase</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> </span><em>总的原则是，只对尚未推送或分享给别人的本地修改执行变基操作清理历史，从不对已推送至别处的提交执行变基操作，这样，你才能享受到两种方式带来的便利</em><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">。</span></p>
<h1 id="4-1-服务器上的-Git-协议"><a href="#4-1-服务器上的-Git-协议" class="headerlink" title="4.1 服务器上的 Git - 协议"></a>4.1 服务器上的 Git - 协议</h1><p>HTTPS 如何指定证书？</p>
<p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">裸仓库目录名以 .git 结尾</span></p>
<h1 id="5-2-分布式-Git-向一个项目贡献"><a href="#5-2-分布式-Git-向一个项目贡献" class="headerlink" title="5.2 分布式 Git - 向一个项目贡献"></a>5.2 分布式 Git - 向一个项目贡献</h1><p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">运行 </span><code>git diff --check</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">，它将会找到可能的空白错误并将它们为你列出来</span></p>
<h1 id="7-1-Git-工具-选择修订版本"><a href="#7-1-Git-工具-选择修订版本" class="headerlink" title="7.1 Git 工具 - 选择修订版本"></a>7.1 Git 工具 - 选择修订版本</h1><p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">值得注意的是，引用日志只存在于本地仓库，一个记录你在你自己的仓库里做过什么的日志。 其他人拷贝的仓库里的引用日志不会和你的相同；而你新克隆一个仓库的时候，引用日志是空的，因为你在仓库里还没有操作。</span></p>
<ul>
<li>SHA-1</li>
<li><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);">当然你提供的 SHA-1 字符数量不得少于 4 个，并且没有歧义</span></li>
<li>分支引用</li>
<li>引用日志(reflog)：<code>HEAD@&#123;5&#125;</code>  <code>master@&#123;yesterday&#125;</code></li>
<li><code>git reflog</code> 来查看日志</li>
<li>祖先引用： <code>HEAD^</code>     <code>HEAD^2</code>   第二父提交</li>
<li><code>HEAD~2</code>  第一父提交的第一父提交 = <code>HEAD^^</code></li>
<li><code>^2</code> 与 <code>~2</code> 的区别 </li>
<li>提交区间</li>
<li><code>master..experiment</code>   experiment 分支中未在 master 分支（哪些提交尚未被合并入 master 分支</li>
<li><code>master...experiment</code> 如果你想看 <code>master</code> 或者 <code>experiment</code> 中包含的但不是两者共有的提交</li>
</ul>
<p>因此下列3个命令是等价的：</p>
<pre spellcheck="false">$ git log refA..refB $ git log ^refA refB $ git log refB --not refA      
</pre>

<p>你想查看所有被 <code>refA</code> 或 <code>refB</code> 包含的但是不被 <code>refC</code> 包含的提交</p>
<pre spellcheck="false">$ git log refA refB ^refC $ git log refA refB --not refC      
</pre>

<p>另一个常用的场景是查看你即将推送到远端的内容：</p>
<pre spellcheck="false">$ git log origin/master..HEAD          
</pre>

<p>这个命令会输出在你当前分支中而不在远程 <code>origin</code> 中的提交。</p>
<h1 id="7-2-Git-工具-交互式暂存"><a href="#7-2-Git-工具-交互式暂存" class="headerlink" title="7.2 Git 工具 - 交互式暂存"></a>7.2 Git 工具 - 交互式暂存</h1><p><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);">运行 </span><code>git add</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 时使用 </span><code>-i</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 或者 </span><code>--interactive</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 选项，Git 将会进入一个交互式终端模式</span></p>
<p>可以在命令行中使用 <code>git add -p</code> 或 <code>git add --patch</code>来启动同样的脚本。</p>
<p>更进一步地，可以使用 <code>reset --patch</code> 命令的补丁模式来部分重置文件，通过 <code>checkout --patch</code> 命令来部分检出文件与 <code>stash save --patch</code> 命令来部分暂存文件。</p>
<p><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);">默认情况下，</span><code>git clean</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 命令只会移除没有忽略的未跟踪文件。 任何与 </span><code>.gitiignore</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 或其他忽略文件中的模式匹配的文件都不会被移除。 </span></p>
<p><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);">现在运行 </span><code>git status</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 会没有输出，因为三棵树又变得相同了。</span></p>
<p><code>reset</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 做的第一件事是移动 HEAD 的指向。 这与改变 HEAD 自身不同（</span><code>checkout</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 所做的）；</span><code>reset</code><span style="color: rgb(78, 68, 60); background-color: rgb(252, 252, 250);"> 移动 HEAD 指向的分支。</span></p>
<h1 id="7-7-Git-工具-重置揭密-TODO"><a href="#7-7-Git-工具-重置揭密-TODO" class="headerlink" title="7.7 Git 工具 - 重置揭密 [TODO]"></a>7.7 Git 工具 - 重置揭密 [TODO]</h1><p>值得好好看一下</p>
<h1 id="7-3-Git-工具-储藏与清理"><a href="#7-3-Git-工具-储藏与清理" class="headerlink" title="7.3 Git 工具 - 储藏与清理"></a>7.3 Git 工具 - 储藏与清理</h1><ul>
<li>文中出现的 <code>git stash</code> 的各种参数和用法</li>
</ul>
<p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">因为它被设计为从工作目录中移除未被追踪的文件。 如果你改变主意了，你也不一定能找回来那些文件的内容。 一个更安全的选项是运行 </span><code>git stash --all</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 来移除每一样东西并存放在栈中。</span></p>
<p><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">默认情况下，</span><code>git clean</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 命令</span><strong>只会移除没有忽略的未跟踪文件</strong><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">。</span><strong> **</strong>任何与 <strong>`</strong>.gitiignore<strong>`</strong> 或其他忽略文件中的模式匹配的文件都不会被移除**<span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);">。 如果你也想要移除那些文件，可以给 clean 命令增加一个 </span><code>-x</code><span style="background-color: rgb(252, 252, 250); color: rgb(78, 68, 60);"> 选项。</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/10/18/Pro-Git-Reading-Note-Part-I/" data-id="cklt0yx5g0002h4ssh7aph8q7" data-title="Pro Git Reading Note Part I" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-管理系统的登录控制？手写一个发布订阅模型！" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/10/17/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%EF%BC%9F%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%EF%BC%81/" class="article-date">
  <time class="dt-published" datetime="2018-10-17T15:10:16.000Z" itemprop="datePublished">2018-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/10/17/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%EF%BC%9F%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%EF%BC%81/">管理系统的登录控制？手写一个发布订阅模型！</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近做了一个后台的项目，既然是后台管理系统，登录的控制自然是少不了的。</p>
<p>接到需求——后台系统！花了几乎半天搞出来了Webpack配置、搞出来了React  Router、搞出来了 React  代码基本的结构，下一步就是搞所谓的“登录逻辑”了。</p>
<p>正好 React v16 大变，而自己最近又有些时候没写过React了，便不妨借这次机会熟悉一下React的新API吧！听说React新出的 Context API 可以“取代Redux”，那这次登录逻辑就用 Context 写吧！</p>
        
          <p class="article-more-link">
            <a href="/2018/10/17/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%EF%BC%9F%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%EF%BC%81/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/10/17/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%EF%BC%9F%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%EF%BC%81/" data-id="cklt0yx5t000gh4ss1v0udpyv" data-title="管理系统的登录控制？手写一个发布订阅模型！" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Context/" rel="tag">Context</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" rel="tag">发布订阅</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-关于Promise的几个Tips" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/18/%E5%85%B3%E4%BA%8EPromise%E7%9A%84%E5%87%A0%E4%B8%AATips/" class="article-date">
  <time class="dt-published" datetime="2018-05-18T04:54:08.000Z" itemprop="datePublished">2018-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/18/%E5%85%B3%E4%BA%8EPromise%E7%9A%84%E5%87%A0%E4%B8%AATips/">关于Promise的几个Tips</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Promise-概念"><a href="#Promise-概念" class="headerlink" title="Promise 概念"></a>Promise 概念</h1><p>略</p>
<h1 id="TIPS1-返回值和方法链"><a href="#TIPS1-返回值和方法链" class="headerlink" title="TIPS1 返回值和方法链"></a>TIPS1 返回值和方法链</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Promise#then(resolveCallback [, rejectCallback])</span><br><span class="line">Promise#catch(rejectCallback)</span><br></pre></td></tr></table></figure>
<p>（其实就是同个方法）</p>
<p>如果Promise是接受态的，会调用resolveCallback，至于会传入什么参数，就要看Promise 写成什么样子了。<br>Promise是拒绝的，会调用rejectCallback。</p>
<p>Promise机制的最大好处：链式调用<br>Promise#then 仍然返回一个Promise，所以可以链式调用Promise#then，一次完成多个异步动作</p>
<h2 id="Callback的返回值和Promise-then的返回值"><a href="#Callback的返回值和Promise-then的返回值" class="headerlink" title="Callback的返回值和Promise#then的返回值"></a>Callback的返回值和Promise#then的返回值</h2><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>then方法返回一个Promise，而它的行为与then中的回调函数的返回值有关：<br>• 如果then中的回调函数返回一个值，那么then返回的Promise将会成为接受状态，并且将返回的值作为接受状态的回调函数的参数值。<br>• 如果then中的回调函数抛出一个错误，那么then返回的Promise将会成为拒绝状态，并且将抛出的错误作为拒绝状态的回调函数的参数值。</p>
<p>• 如果then中的回调函数返回一个已经是接受状态的Promise，那么then返回的Promise也会成为接受状态，并且将那个Promise的接受状态的回调函数的参数值作为该被返回的Promise的接受状态回调函数的参数值。<br>• 如果then中的回调函数返回一个已经是拒绝状态的Promise，那么then返回的Promise也会成为拒绝状态，并且将那个Promise的拒绝状态的回调函数的参数值作为该被返回的Promise的拒绝状态回调函数的参数值。<br>• 如果then中的回调函数返回一个未定状态（pending）的Promise，那么then返回Promise的状态也是未定的，并且它的终态与那个Promise的终态相同；同时，它变为终态时调用的回调函数参数与那个Promise变为终态时的回调函数的参数是相同的。</p>
<ul>
<li>Callback中 return<br>#then返回一个接受态的Promise。相当于Promise.resolve(what_returned_by_your_code)<br>于是你可以在链中接进去一个#then</li>
<li>Callback中 throw。<br>返回拒绝的Promise。= Promise.reject(what_thrown_by_you)<br>会调用接下来的#catch</li>
<li>Callback中返回Promise 接受态/拒绝态/等待态<br>#then返回值就是你在Callback中返回的Promise。因为这个特性，所以你可以进行多个连续的一环套一环的异步操作了。</li>
</ul>
<p>【注意】上面的规则无论针对resolveCb还是rejectCb都是适用的，#then返回的Promise的状态和从哪个Callback返回的无关。即使是一个失败的Promise，经过#then的处理，也可以返回一个成功的Promise以继续方法链。<br>“在一个失败操作（即一个 catch）之后可以继续使用链式操作，即使链式中的一个动作失败之后还能有助于新的动作继续完成。”</p>
<p>【注意】JS引擎抛出的错误也会导致#then返回失败的Promise，但是不会在console里有任何提示。所以特别注意“静默失败”问题。 —-下面会再谈这个事情。</p>
<h1 id="TIPS2-Callback的坑"><a href="#TIPS2-Callback的坑" class="headerlink" title="TIPS2 Callback的坑"></a>TIPS2 Callback的坑</h1><p>虽然在executor 里面可以 resolve(arg1, arg2, …) 或者reject(arg1, arg2, …)。但是在Callback只有第一个参数是可用的。<br>MDN上 也明确指出了这一点。参看MDN文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">  reject(&#123;a: 1, b: 2&#125;, &#39;arg2&#39;)</span><br><span class="line">&#125;).catch((...args) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(args)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">[…]</span><br><span class="line">  0: Object &#123; a: 1, b: 2 &#125;</span><br><span class="line">  length: 1 &#x2F;* ⚠ *&#x2F;</span><br><span class="line">  __proto__: Array []</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* 只好这样了：还算优雅吧 *&#x2F;</span><br><span class="line">new Promise((resolve) &#x3D;&gt; &#123;</span><br><span class="line">  resolve(&#123;a: 1, b: 2&#125;);</span><br><span class="line">&#125;).then((&#123;a, b&#125;) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(a, b);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="TIPS3-隆重介绍：Promise-finally"><a href="#TIPS3-隆重介绍：Promise-finally" class="headerlink" title="TIPS3 隆重介绍：Promise#finally"></a>TIPS3 隆重介绍：Promise#finally</h1><p>finally() 方法返回一个Promise，在执行then()和catch()后，都会执行finally指定的回调函数。避免同样的语句需要在then()和catch()中各写一次的情况。<br>#finally的返回值：返回此#finally附加到的Promise本身。<br>finally的回调函数中不接收任何参数</p>
<p>但是现在浏览器支持还不算很好。</p>
<h1 id="TIPS5-then-success-fail-与-then-success-catch-fail-的区别"><a href="#TIPS5-then-success-fail-与-then-success-catch-fail-的区别" class="headerlink" title="TIPS5 .then(success, fail) 与 .then(success).catch(fail) 的区别"></a>TIPS5 <code>.then(success, fail)</code> 与 <code>.then(success).catch(fail)</code> 的区别</h1><p>.catch 里的fail会把.then的success中的错误捕获住。但是前一种方法不会</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var somePromise &#x3D; Promise.resolve(&#123;code: 200, data: &#39;OK&#39;&#125;);</span><br><span class="line"></span><br><span class="line">somePromise</span><br><span class="line">.then(() &#x3D;&gt; &#123;</span><br><span class="line">  undefined.undefined;</span><br><span class="line">  &#x2F;&#x2F; A silly error you haven&#39;t noticed</span><br><span class="line">  console.log(&#39;你的表单已提交！&#39;);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(() &#x3D;&gt; &#123;</span><br><span class="line">  console.error(&#39;提交表单时遇到问题，请检查网络！&#39;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * [ERROR] &quot;提交表单时遇到问题，请检查网络！&quot;</span><br><span class="line"> * 你可能会先从 somePromise 上找问题</span><br><span class="line"> * 你手抖写下的错误代码被“藏”起来了</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">somePromise</span><br><span class="line">.then(() &#x3D;&gt; &#123;</span><br><span class="line">  undefined.undefined;</span><br><span class="line">  &#x2F;&#x2F; A silly error you haven&#39;t noticed</span><br><span class="line">  console.log(&#39;你的表单已提交！&#39;);</span><br><span class="line">&#125;, () &#x3D;&gt; &#123;</span><br><span class="line">  console.error(&#39;提交表单时遇到问题，请检查网络！&#39;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line"> * TypeError: undefined has no properties</span><br><span class="line"> * 我想你一看控制台就知道问题出在哪里了</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure>
<p><strong>小调查：你们喜欢怎么写？</strong></p>
<h1 id="TIPS7-深入JS引擎，探究-Promise-与-Event-Loop"><a href="#TIPS7-深入JS引擎，探究-Promise-与-Event-Loop" class="headerlink" title="TIPS7 深入JS引擎，探究 Promise 与 Event Loop"></a>TIPS7 深入JS引擎，探究 Promise 与 Event Loop</h1><p>来自hzy的解答（基于Node.js / V8）</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/topics/850">https://newbbs.bingyan.net/topics/850</a></p>
<p>问题：<strong>ECMAScript 规范中没有叫 Event Loop、Task List、Micro Task 等概念！</strong> 所以，还是读规范吧。</p>
<p>开始阅读ECMA规范</p>
<p>Note<br>Typically an ECMAScript implementation will have its Job Queues pre-initialized with at least one PendingJob and one of those Jobs will be the first to be executed. An implementation might choose to free all resources and terminate if the current Job completes and all Job Queues are empty. Alternatively, it might choose to wait for a some implementation specific agent or mechanism to enqueue new PendingJob requests.</p>
<p>The following abstract operations are used to create and manage Jobs and Job Queues:</p>
<p>running execution context == 执行栈</p>
<p>但是，PromiseJobs执行的先后次序规范中没有提到<br>所以，读规范读到最后，还是不知道是怎么回事。<br>但是，现在的主流浏览器中Promise回调都在其他回调（如setTimeout）之前。待解答。</p>
<h2 id="尾声：看一道题目"><a href="#尾声：看一道题目" class="headerlink" title="尾声：看一道题目"></a>尾声：看一道题目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">console.log(1);</span><br><span class="line">new Promise(function (resolve, reject)&#123;</span><br><span class="line">    reject(true);</span><br><span class="line">    window.setTimeout(function ()&#123;</span><br><span class="line">        resolve(false);</span><br><span class="line">    &#125;, 0);</span><br><span class="line">&#125;).then(function()&#123;</span><br><span class="line">    console.log(2);</span><br><span class="line">&#125;, function()&#123;</span><br><span class="line">    console.log(3);</span><br><span class="line">&#125;);</span><br><span class="line">console.log(4);</span><br></pre></td></tr></table></figure>
<p>来自 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000006172528">https://segmentfault.com/a/1190000006172528</a></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/18/%E5%85%B3%E4%BA%8EPromise%E7%9A%84%E5%87%A0%E4%B8%AATips/" data-id="cklt0yx5n0009h4ss2wr7b8xl" data-title="关于Promise的几个Tips" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Windows-Git中OpenSSH无ssh-agent多密钥配置小记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/17/Windows-Git%E4%B8%ADOpenSSH%E6%97%A0ssh-agent%E5%A4%9A%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE%E5%B0%8F%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2018-03-17T14:34:56.000Z" itemprop="datePublished">2018-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/17/Windows-Git%E4%B8%ADOpenSSH%E6%97%A0ssh-agent%E5%A4%9A%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE%E5%B0%8F%E8%AE%B0/">Windows-Git中OpenSSH无ssh-agent多密钥配置小记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近Git环境崩了，只好重新配置一下。笔者使用的是Windows环境，众所周知，Windows下面配置各种环境都很坑的，Git也不例外。我感觉最大的坑就是SSH的问题。Windows下面 <code>ssh-agent</code> <strong>不自动启动，不长驻内存</strong>。当然，我可以强行设置一波系统自启动，也可以通过配置使得在启动 Git Bash 的时候先静默执行agent再进入环境——虽然都可以解决问题，<strong>但是总是感觉不舒服</strong>。此外，我手里也有多个私钥，在使用Git时，<strong>我需要把这些私钥都载入</strong>。</p>
        
          <p class="article-more-link">
            <a href="/2018/03/17/Windows-Git%E4%B8%ADOpenSSH%E6%97%A0ssh-agent%E5%A4%9A%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE%E5%B0%8F%E8%AE%B0/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/03/17/Windows-Git%E4%B8%ADOpenSSH%E6%97%A0ssh-agent%E5%A4%9A%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE%E5%B0%8F%E8%AE%B0/" data-id="cklt0yx5k0005h4ss47waa31p" data-title="Windows-Git中OpenSSH无ssh-agent多密钥配置小记" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" rel="tag">开发工具</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CSS-视觉格式化模型-Visual-Formatting-Model" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/02/18/CSS-%E8%A7%86%E8%A7%89%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A8%A1%E5%9E%8B-Visual-Formatting-Model/" class="article-date">
  <time class="dt-published" datetime="2018-02-18T04:52:09.000Z" itemprop="datePublished">2018-02-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/02/18/CSS-%E8%A7%86%E8%A7%89%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A8%A1%E5%9E%8B-Visual-Formatting-Model/">CSS 视觉格式化模型 Visual Formatting Model</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/7e8f35beff7b07022095b9bc4b634416.png"><br><img src="https://newbbs.bingyan.net/photo/2018/7e8f35beff7b07022095b9bc4b634416.png" alt="img"></a></p>
<h1 id="What’s-CSS-Visual-Formatting-Model"><a href="#What’s-CSS-Visual-Formatting-Model" class="headerlink" title="What’s CSS Visual Formatting Model"></a>What’s CSS Visual Formatting Model</h1><ul>
<li>视觉格式化模型(visual formatting model)是用来处理文档并将它显示在视觉媒体上的机制。</li>
<li>根据CSS盒模型，浏览器为文档元素生成盒子(Box)。视觉格式化模型就是文档里的“盒子布局呈现的一种规则”。</li>
</ul>
<h1 id="Basic-Concepts-in-CSS-specification"><a href="#Basic-Concepts-in-CSS-specification" class="headerlink" title="Basic Concepts in CSS specification"></a>Basic Concepts in CSS specification</h1><h3 id="The-“Box”-in-the-sight-of-W3C"><a href="#The-“Box”-in-the-sight-of-W3C" class="headerlink" title="The “Box” in the sight of W3C"></a>The “Box” in the sight of W3C</h3><p>各位至少对CSS盒模型有所耳闻吧？CSS盒子（Box）是由 CSS 引擎根据文档中的内容所创建，用于文档元素的定位、布局和格式化等的布局单位。</p>
<blockquote>
<p><strong>Q: 一个元素 等于 一个盒子 ？</strong></p>
<p>A: 我都这么问了，答案肯定是否定的。反例：</p>
<ol>
<li><code>&lt;li&gt;</code> 元素，除了标签内容之外，前面的项目符号也生成了一个盒子。</li>
<li>跨行的行内元素（例如 大段的文本）。分布在不同行的部分分别属于不同的盒子。</li>
</ol>
</blockquote>
<h3 id="Overview-Block-Inline-and-Boxes"><a href="#Overview-Block-Inline-and-Boxes" class="headerlink" title="Overview: Block , Inline and Boxes"></a>Overview: Block , Inline and Boxes</h3><p>很多概念你可以分得清吗？</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/2766dbbad7cb2b9d773b5e699f53f450.png"><img src="https://newbbs.bingyan.net/photo/2018/2766dbbad7cb2b9d773b5e699f53f450.png" alt="img"></a></p>
<p><strong>术语表：*见文末*。</strong></p>
<ul>
<li>块盒(Block Box)：既是块级盒(Block Level Box) 也是 块容器盒(Block Container Box) 的盒子。</li>
<li>包含块(containing block): 包含其他盒子的块称为包含块。</li>
</ul>
<h3 id="块级盒子-Block-Level-Box"><a href="#块级盒子-Block-Level-Box" class="headerlink" title="块级盒子 // Block-Level Box"></a>块级盒子 // Block-Level Box</h3><p><strong>当元素的 display为block、list-item或table时，该元素将成为块级元素。</strong> 块级盒子参与块级格式化上下文。块级盒子描述元素与其父元素和兄弟元素之间的行为。块容器盒子描述了元素跟其后代之间的行为（例如，子元素相对父元素进行定位）。</p>
<ul>
<li><strong>有些块级盒子并不是块容器盒子。</strong> 比如表格，表格的单元格明显不是块级嘛，但是它还是可以包含div等块级的盒子。其实表格内部是“表格格式化上下文”。</li>
<li><strong>有些块容器盒子也不是块级盒子</strong> 。如非替换行内级块和非替换表格单元格。（下文有具体的例子）。</li>
</ul>
<blockquote>
<p><strong>Q: 什么是替换元素？</strong></p>
<p>替换元素就是浏览器根据元素的标签和属性，来决定元素的具体显示内容。比如<code>img</code>元素通过<code>src</code>属性的值来读取图片信息并显示出来，而 HTML 代码里没有图片的实际内容；又例如 <code>input</code> 元素的 <code>type</code> 属性决定是显示输入框，还是单选按钮等。<br><code>html&lt;img src=&quot;girl.jpg&quot;/&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;/&gt;</code></p>
<p>HTML 的大多数元素是非替换元素，即浏览器直接渲染HTML标签内的内容。 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;p的内容&lt;&#x2F;p&gt;</span><br><span class="line">&lt;em&gt;label的内容&lt;&#x2F;em&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>## </p>
<blockquote>
<p><strong>Q: “块级元素” 对应一个 “块级盒子”?</strong></p>
<p>A: 不一定。大多数块级元素都仅会生成一个块级盒子。但有的块级元素 <code>&lt;li&gt;</code>可能会生成更多盒子。</p>
</blockquote>
<h3 id="行内级盒子-Inline-Level-Box"><a href="#行内级盒子-Inline-Level-Box" class="headerlink" title="行内级盒子 // Inline-Level Box"></a>行内级盒子 // Inline-Level Box</h3><p>行内级元素是 <code>display</code> 属性为 <code>inline-*</code> 的元素和其他默认行内的元素。</p>
<p>行内级元素会生成行内级盒子，参与行内格式化上下文（IFC）。</p>
<blockquote>
<p><strong>Q：“原子”可以再分吗？</strong>或者说 生成 “原子行内级盒子” 的元素 可以拥有子元素吗？</p>
</blockquote>
<h3 id="行内级盒子-vs-行内盒子-vs-原子行内级盒子"><a href="#行内级盒子-vs-行内盒子-vs-原子行内级盒子" class="headerlink" title="行内级盒子 vs. 行内盒子 vs. 原子行内级盒子"></a>行内级盒子 vs. 行内盒子 vs. 原子行内级盒子</h3><p>傻傻分不清。<strong>“行内级盒子” 分为 “行内盒” 与 “原子行内级盒” 两种。 注意概念区分与包含关系</strong> 。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/18918e6b5fc9dc6a2b2d5eb515f3c251.png"><img src="https://newbbs.bingyan.net/photo/2018/18918e6b5fc9dc6a2b2d5eb515f3c251.png" alt="img"></a></p>
<h4 id="行内盒子-Inline-Box"><a href="#行内盒子-Inline-Box" class="headerlink" title="行内盒子 // Inline-Box"></a>行内盒子 // Inline-Box</h4><p>其内容会参与创建其容器的行内格式化上下文。可以被拆分成多个盒子然后放置在包含它的盒子里。</p>
<p>例如：<code>display: inline</code></p>
<p>下面这张图片里，蓝色字包含在<code>&lt;em&gt;</code>里面。而这个标签拆成了三个块，和包含它的盒子的行内盒子“融为一体”，也就是所谓的<code>“参与创建其容器的行内格式化上下文”</code>。</p>
<p>（下图的绿色虚线框使用<code>CSS outline 属性</code>生成。印证了“生成三个盒子”的说法。）</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/50571bc1ec99df9e1fea0f0b780c4321.png"><img src="https://newbbs.bingyan.net/photo/2018/50571bc1ec99df9e1fea0f0b780c4321.png" alt="img"></a></p>
<h4 id="原子行内级盒子-Atomic-Inline-Level-Box"><a href="#原子行内级盒子-Atomic-Inline-Level-Box" class="headerlink" title="原子行内级盒子 // Atomic Inline-Level Box"></a>原子行内级盒子 // Atomic Inline-Level Box</h4><p>内容不参与行内格式化上下文的创建，像原子一样不可再拆成多个盒子。</p>
<p>例子： 替换行内级元素（例<code>&lt;img /&gt;</code>）、<code>display: inline-block</code>、<code>inline-table</code>。</p>
<p>下图的<code>&lt;em&gt;</code>被添加了<code>inline-block</code>，成为原子行内级元素。它自成”独立王国“，其内容 <em>不会</em> 参与其容器盒子的格式化上下文。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/73e9c8e631156c77f4e9b4b0f1331041.png"><img src="https://newbbs.bingyan.net/photo/2018/73e9c8e631156c77f4e9b4b0f1331041.png" alt="img"></a></p>
<h4 id="原子行内级盒的排布"><a href="#原子行内级盒的排布" class="headerlink" title="原子行内级盒的排布"></a>原子行内级盒的排布</h4><p>原子行内盒在行内格式化上下文里 <strong>不能拆成多个盒子</strong> 。</p>
<p>默认情况下，如果一行的剩余空间容不下，那就去新开一行；如果新开的一行也容不下，那就算溢出容器也不让拆成多个盒子。</p>
<p><strong>单个汉字 / 单个英文单词 就是一个自然的原子行内级盒</strong> 。当然，一些CSS属性会改变对“原子”的判定，例如 <code>word-break: break-all</code>。见下图。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/f67abd5d7a768c10b3b57bb2d24d207a.png"><img src="https://newbbs.bingyan.net/photo/2018/f67abd5d7a768c10b3b57bb2d24d207a.png" alt="img"></a></p>
<blockquote>
<p><strong>Q：“原子”可以再分吗？</strong>或者说 生成 “原子行内级盒子” 的元素 可以拥有子元素吗？</p>
<p>A: 可以包含子元素。<code>display: inline-block</code>的元素会生成原子行内级盒子，也可以包含子元素。</p>
</blockquote>
<h3 id="题外话：Line-Box-行盒-是什么"><a href="#题外话：Line-Box-行盒-是什么" class="headerlink" title="题外话：Line-Box 行盒 是什么"></a>题外话：Line-Box 行盒 是什么</h3><p>行盒（Line Box, 也叫行框）是由行内格式化上下文(IFC)产生的盒，用于表示一行。在块盒里面，行盒从块盒一边排版到另一边（从左右浮动元素边缘开始计）。</p>
<p><em>一般我们 CSS 布局时不需关注。这和我们上文讨论的概念没有直接的联系。</em></p>
<h3 id="没有盒子也要强行加盒子——匿名盒子"><a href="#没有盒子也要强行加盒子——匿名盒子" class="headerlink" title="没有盒子也要强行加盒子——匿名盒子"></a>没有盒子也要强行加盒子——匿名盒子</h3><p>在某些情况下进行视觉格式化时，需要添加一些增补性的盒子，这些盒子 <strong>不能</strong> 用CSS选择符选中，称为 <strong>匿名盒子（anonymous boxes）</strong> 。</p>
<p>不能被 CSS 选择符选中意味着不能用样式表添加样式。不过，它们的样式表现可以这样理解：<br>🔸可继承的 CSS 属性值都为 <code>inherit</code><br>🔸不可继承的 CSS 属性值都为 <code>initial</code></p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/4ef4f442d3e2a9f436e9fc6d9d92230a.png"><img src="https://newbbs.bingyan.net/photo/2018/4ef4f442d3e2a9f436e9fc6d9d92230a.png" alt="img"></a></p>
<p>上图含有了两个匿名块盒子，下图显示了两个匿名行内盒子。</p>
<h1 id="Various-“Formatting-Contexts”"><a href="#Various-“Formatting-Contexts”" class="headerlink" title="Various “Formatting Contexts”"></a>Various “Formatting Contexts”</h1><h3 id="What’s-Formatting-Context"><a href="#What’s-Formatting-Context" class="headerlink" title="What’s Formatting Context"></a>What’s Formatting Context</h3><p>“格式化上下文”…… 什么叫“上下文”，真是一个蹩脚的翻译！</p>
<p>我的理解：每种 <em>环境(context)</em> 各自对应着盒模型格式化的一套 <em>规则(layout)</em></p>
<blockquote>
<p>Boxes in the normal flow belong to a formatting context</p>
<p>正常流中的盒子属于某一个格式化上下文。</p>
<p>正常流：文档流，非绝对定位的盒子在其中。</p>
</blockquote>
<p>下面是几种FC：</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/4f07d3e67edf70f09ba92c1b687080d8.png"><img src="https://newbbs.bingyan.net/photo/2018/4f07d3e67edf70f09ba92c1b687080d8.png" alt="img"></a></p>
<h3 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h3><h4 id="产生条件"><a href="#产生条件" class="headerlink" title="产生条件"></a>产生条件</h4><ol>
<li><u>根元素</u>或其它包含它的元素</li>
<li>浮动<code>float: left/right/inherit</code></li>
<li>绝对定位<code>position: absolute/fixed</code></li>
<li>行内块<code>display: inline-block</code></li>
<li>表格单元格<code>display: table-cell</code></li>
<li>表格标题<code>display: table-caption</code></li>
<li>溢出元素 <code>overflow: hidden/scroll/auto/inherit</code>（“浮动坍塌”的快捷解决方案之一）</li>
</ol>
<h4 id="布局规则"><a href="#布局规则" class="headerlink" title="布局规则"></a>布局规则</h4><ul>
<li>内部的Box会在垂直方向，一个接一个地放置。</li>
<li>Box垂直方向的距离由margin决定。属于同一个BFC的两个相邻Box的margin会发生重叠。</li>
<li>每个元素的marginbox的左边，与包含块borderbox的左边相接触。即使存在浮动也是如此。</li>
<li><strong>BFC的区域不会与float box重叠</strong> 。</li>
<li>BFC就是页面上的一个隔离的独立容器， <strong>容器里面的子元素不会影响到外面的元素</strong> 。反之也如此。</li>
<li><strong>计算BFC的高度时，浮动元素也参与计算</strong> 。</li>
</ul>
<h4 id="实用层面"><a href="#实用层面" class="headerlink" title="实用层面"></a>实用层面</h4><ul>
<li>浮动区域不叠加到BFC区域上</li>
<li>防止与浮动元素重叠</li>
<li>防止margin合并</li>
<li>float高度塌陷</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2018/65c91d27b6b5bee5ae574f2f4fd3fca4.png"><img src="https://newbbs.bingyan.net/photo/2018/65c91d27b6b5bee5ae574f2f4fd3fca4.png" alt="img"></a></p>
<h4 id="Related-Demos"><a href="#Related-Demos" class="headerlink" title="Related Demos"></a>Related Demos</h4><p>防止与浮动元素重叠 | <a target="_blank" rel="noopener" href="https://codepen.io/SitePoint/pen/xGpMRP">https://codepen.io/SitePoint/pen/xGpMRP</a></p>
<p>margin collapse | <a target="_blank" rel="noopener" href="https://codepen.io/SitePoint/pen/XbVOXp">https://codepen.io/SitePoint/pen/XbVOXp</a></p>
<p>自己写一个 | <a target="_blank" rel="noopener" href="https://codepen.io/xuxinhang/pen/QmXEWz">https://codepen.io/xuxinhang/pen/QmXEWz</a></p>
<h3 id="IFC"><a href="#IFC" class="headerlink" title="IFC"></a>IFC</h3><h4 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h4><p>一个块级元素中 <strong>仅</strong> 包含内联级别元素。</p>
<p>所以如果还包含块级盒子那内部是BFC。（参见 ”匿名盒子“小节 的例子。）</p>
<h4 id="布局规则-1"><a href="#布局规则-1" class="headerlink" title="布局规则"></a>布局规则</h4><ul>
<li>内部的盒子会在水平方向，一个接一个地放置。</li>
<li>这些盒子垂直方向的起点从包含块盒子的顶部开始。</li>
<li>摆放这些盒子的时候，它们在水平方向上的 padding、border、margin 所占用的空间都会被考虑在内。</li>
<li>在垂直方向上，这些框可能会以不同形式来对齐（vertical-align）：它们可能会使用底部或顶部对齐，也可能通过其内部的文本基线（baseline）对齐。</li>
<li>能把在一行上的框都完全包含进去的一个矩形区域，被称为该行的 <strong>行框（line box）</strong>。 <strong>行框的宽度是由包含块（containing box）和存在的浮动来决定</strong> 。</li>
<li>IFC中的 line box 一般左右边都贴紧其包含块，但是会因为float元素的存在发生变化。float 元素会位于IFC与与 line box 之间，使得 line box 宽度缩短。</li>
<li>IFC 中的 line box 高度由 CSS 行高计算规则来确定，同个 IFC 下的多个 line box 高度可能会不同（比如一行包含了较高的图片，而另一行只有文本）</li>
<li>当 inline-level boxes 的总宽度少于包含它们的 line box 时，其水平渲染规则由 text-align 属性来确定，如果取值为 justify，那么浏览器会对 inline-boxes（注意不是inline-table 和 inline-block boxes）中的文字和空格做出拉伸。</li>
<li><strong>【敲黑板】</strong> <em>当一个 inline box 超过 line box 的宽度时，它会被分割成多个boxes，这些 boxes 被分布在多个 line box 里。如果一个 inline box 不能被分割（比如只包含单个字符，或 word-breaking 机制被禁用，或该行内框受 white-space 属性值为 nowrap 或 pre 的影响），那么这个 inline box 将溢出这个 line box。</em></li>
</ul>
<h4 id="实用"><a href="#实用" class="headerlink" title="实用"></a>实用</h4><ul>
<li>水平居中：当一个块要在环境中水平居中时，设置其为 inline-block 则会在外层产生 IFC，通过设置父容器 text-align:center 则可以使其水平居中。</li>
<li>垂直居中：创建一个IFC，用其中一个元素撑开父元素的高度，然后设置其 vertical-align:middle，其他行内元素则可以在此父元素下垂直居中。</li>
</ul>
<h3 id="FFC"><a href="#FFC" class="headerlink" title="FFC"></a>FFC</h3><h4 id="触发条件-1"><a href="#触发条件-1" class="headerlink" title="触发条件"></a>触发条件</h4><p>当 <code>display</code>的值为<code>flex</code>或<code>inline-flex</code>时，其内容建立了一个新的 <strong>弹性格式化上下文</strong> 。</p>
<h4 id="布局规则-2"><a href="#布局规则-2" class="headerlink" title="布局规则"></a>布局规则</h4><ul>
<li>设置为 flex 的容器被渲染为一个块级元素</li>
<li>设置为 inline-flex 的容器则渲染为一个行内元素</li>
<li>弹性容器中的每一个子元素都是一个弹性项目。弹性项目可以是任意数量的。弹性容器外和弹性项目内的一切元素都不受影响。</li>
</ul>
<p><em>FFC 里也可存在匿名盒子！</em></p>
<h3 id="GFC"><a href="#GFC" class="headerlink" title="GFC"></a>GFC</h3><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><p>当为一个元素设置为网格布局<code>display: grid/grid-inline</code>的时候，此元素内部将会是一个 <strong>GFC</strong> 。</p>
<h4 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h4><p>通过在网格容器（grid container）上定义网格定义行（grid definition rows）和网格定义列（grid definition columns）属性各在网格项目（grid item）上定义网格行（grid row）和网格列（grid columns）为每一个网格项目（grid item）定义位置和空间。</p>
<h3 id="TFC-Table-FC"><a href="#TFC-Table-FC" class="headerlink" title="TFC (Table-FC)"></a>TFC (Table-FC)</h3><p>In terms of the visual formatting model, a table can behave like a <a target="_blank" rel="noopener" href="https://www.w3.org/TR/CSS22/visuren.html">block-level</a> (for ‘<code>display:table</code>‘)or <a target="_blank" rel="noopener" href="https://www.w3.org/TR/CSS22/visuren.html">inline-level</a> (for <code>&#39;display:inline-table&#39;</code>)element.</p>
<p>The table box establishes a <strong>table formatting context</strong> .</p>
<p>互联网上的文章为什么都没有提到 TFC ？可能是谈到这个点的时候 CSS 规范直接”参考Table章节“了吧……</p>
<p>TFC也存在匿名盒子。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;display: table;&quot;&gt;</span><br><span class="line">    I&#39;m in an anonymous table cell actually.</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<p>你看到的文本其实在一个 显式的table盒子 里的 匿名的table-row盒子 里的 匿名的table-cell盒子 里。</p>
<h1 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h1><h4 id="Vocabulary"><a href="#Vocabulary" class="headerlink" title="Vocabulary"></a>Vocabulary</h4><p><em>来自 MDN 的整理</em></p>
<blockquote>
<ul>
<li><strong>块</strong>：block，一个抽象的概念，一个块在文档流上占据一个独立的区域，块与块之间在垂直方向上按照顺序依次堆叠。</li>
<li><strong>包含块</strong>：containing block，包含其他盒子的块称为包含块。</li>
<li><strong>盒子</strong>：box，一个抽象的概念，由CSS引擎根据文档中的内容所创建，主要用于文档元素的定位、布局和格式化等用途。盒子与元素并不是一一对应的，有时多个元素会合并生成一个盒子，有时一个元素会生成多个盒子（如匿名盒子）。</li>
<li><strong>块级元素</strong>：block-level element，元素的 <code>display</code> 为 <code>block</code>、<code>list-item</code>、<code>table</code> 时，该元素将成为块级元素。元素是否是块级元素仅是元素本身的属性，并不直接用于格式化上下文的创建或布局。</li>
<li><strong>块级盒子</strong>：block-level box，由块级元素生成。一个块级元素至少会生成一个块级盒子，但也有可能生成多个（例如列表项元素）。</li>
<li><strong>块盒子</strong>：block box，如果一个块级盒子同时也是一个块容器盒子（见下），则称其为块盒子。除具名块盒子之外，还有一类块盒子是匿名的，称为匿名块盒子（Anonymous block box），匿名盒子无法被CSS选择符选中。</li>
<li><strong>块容器盒子</strong>：block container box或block containing box，块容器盒子侧重于当前盒子作为“容器”的这一角色，它不参与当前块的布局和定位，它所描述的仅仅是当前盒子与其后代之间的关系。换句话说，块容器盒子主要用于确定其子元素的定位、布局等。</li>
</ul>
<p>注意：盒子分为“块盒子”和“块级盒子”两种，但元素只有“块级元素”，而没有“块元素”。下面的“行内级元素”也是一样。</p>
<ul>
<li><strong>行内级元素</strong>：inline-level element，<code>display</code> 为 <code>inline</code>、<code>inline-block</code>、<code>inline-table</code> 的元素称为行内级元素。与块级元素一样，元素是否是行内级元素仅是元素本身的属性，并不直接用于格式化上下文的创建或布局。</li>
<li><strong>行内级盒子</strong>：inline-level box，由行内级元素生成。行内级盒子包括行内盒子和原子行内级盒子两种，区别在于该盒子是否参与行内格式化上下文的创建。</li>
<li><strong>行内盒子</strong>：inline box，参与行内格式化上下文创建的行内级盒子称为行内盒子。与块盒子类似，行内盒子也分为具名行内盒子和匿名行内盒子（anonymous inline box）两种。</li>
<li><strong>原子行内级盒子</strong>：atomic inline-level box，不参与行内格式化上下文创建的行内级盒子。原子行内级盒子一开始叫做原子行内盒子（atomic inline box），后被修正。原子行内级盒子的内容不会拆分成多行显示。</li>
</ul>
</blockquote>
<h4 id="看CSS规范的一些注意事项"><a href="#看CSS规范的一些注意事项" class="headerlink" title="看CSS规范的一些注意事项"></a>看CSS规范的一些注意事项</h4><ul>
<li>CSS3开始，CSS规范把各个部分拆成了很多各自独立、并行发展的小规范，就像打补丁。要看本文的点，还是要去看CSS2的规范，因为CSS3规范是没有定义这些点的。</li>
<li>比ECMAScript规范易读。</li>
</ul>
<h4 id="Refer-to"><a href="#Refer-to" class="headerlink" title="Refer to"></a>Refer to</h4><p><a target="_blank" rel="noopener" href="https://www.sitepoint.com/understanding-block-formatting-contexts-in-css/">https://www.sitepoint.com/understanding-block-formatting-contexts-in-css/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/TR/css-display-3/#flow-layout">https://www.w3.org/TR/css-display-3/#flow-layout</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/TR/CSS22/tables.html#model">https://www.w3.org/TR/CSS22/tables.html#model</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Visual_formatting_model">https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Visual_formatting_model</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013372963">https://segmentfault.com/a/1190000013372963</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/02/18/CSS-%E8%A7%86%E8%A7%89%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A8%A1%E5%9E%8B-Visual-Formatting-Model/" data-id="cklt0yx5e0001h4ss6oxn5o2u" data-title="CSS 视觉格式化模型 Visual Formatting Model" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-指南：如何让Webpack包加载得更快" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/03/01/%E6%8C%87%E5%8D%97%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%A9Webpack%E5%8C%85%E5%8A%A0%E8%BD%BD%E5%BE%97%E6%9B%B4%E5%BF%AB/" class="article-date">
  <time class="dt-published" datetime="2017-03-01T04:46:23.000Z" itemprop="datePublished">2017-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/03/01/%E6%8C%87%E5%8D%97%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%A9Webpack%E5%8C%85%E5%8A%A0%E8%BD%BD%E5%BE%97%E6%9B%B4%E5%BF%AB/">指南：如何让Webpack包加载得更快</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/4ab27a9426ce3fc36133257bec467464.png"><img src="https://newbbs.bingyan.net/photo/2017/4ab27a9426ce3fc36133257bec467464.png" alt="img"></a> </p>
<h1 id="我们为什么需要加载更快的包"><a href="#我们为什么需要加载更快的包" class="headerlink" title="我们为什么需要加载更快的包"></a>我们为什么需要加载更快的包</h1><ol>
<li>减少首屏加载时间。 在目前国内的网络条件下，通常一个网站，如果“首屏时间”在2秒以内是比较优秀的，5秒以内用户可以接受，10秒以上就不可容忍了。</li>
<li>减小打包体积。 并不是每个地方都有4G（去过东图书库吗）</li>
</ol>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/8bf8f21071a2e1dd6a43796444548325.png"><img src="https://newbbs.bingyan.net/photo/2017/8bf8f21071a2e1dd6a43796444548325.png" alt="img"></a></p>
<h1 id="打包分析工具：找一双好眼睛"><a href="#打包分析工具：找一双好眼睛" class="headerlink" title="打包分析工具：找一双好眼睛"></a>打包分析工具：找一双好眼睛</h1><h2 id="入门工具"><a href="#入门工具" class="headerlink" title="入门工具"></a>入门工具</h2><p>说起 <strong>入门级工具</strong> ，个人感觉比较好用的是“Webpack Visualizer”和“Webpack bundle analyzer”。前者输出环形图，后者是框图，根据自己的喜好选择。很好上手，配置也非常简单，可输出结果为HTML文件。使用这些工具可以很清楚的看到每个bundle分别打包了哪些代码，哪些占据了最大的体积，也可以观察哪些代码其实是无用的可以优化掉的。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/c4a4024614f6c518a1bb8e31c35e23bb.png"><img src="https://newbbs.bingyan.net/photo/2017/c4a4024614f6c518a1bb8e31c35e23bb.png" alt="img"></a></p>
<p>比如说下面这张图，我们可以看到vendor文件占了大头，而且axios和fetch两个库功能重复了——这是我之前从来没有注意到的。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/a6cd3cd023375a2fd1cde3c75b57db84.png"><img src="https://newbbs.bingyan.net/photo/2017/a6cd3cd023375a2fd1cde3c75b57db84.png" alt="img"></a></p>
<h2 id="进阶工具"><a href="#进阶工具" class="headerlink" title="进阶工具"></a>进阶工具</h2><p>如果需要 <strong>更详细的分析</strong> ，可以使用Webpack官方出品的在线包分析工具（<a target="_blank" rel="noopener" href="http://webpack.github.io/analyse/">http://webpack.github.io/analyse/</a>）。它提供了更强大的功能：查看模块之间的引用关系、模块关系图（虽然是一团乱麻）、从Module和Chunk等多个个角度进行分析、Assets文件分析。</p>
<p><strong>【使用指引】</strong></p>
<ol>
<li>得到stat.json文件。 stat.json存储了某次打包中详细的信息。所有的分析工具都基这个webpack的功能。</li>
<li>可以使用下面的webpack命令行参数 <code>webpack --profile --json &gt; compilation-stats.json</code> 会保存到compilation-stats.json里</li>
<li>上面提到的可视化工具也都提供了生成stat.json的选项。具体参照它们的Github</li>
<li>上传 stat.json 文件</li>
<li>报告生成，好好看一看吧！</li>
</ol>
<p><strong>【怎么看报告】</strong></p>
<ul>
<li>上传你的json文件，长传后会看到这么一个界面，会简单描述你的webpack的版本，有多少modules，多少chunks等等</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/7cf14189dab4a369d923e5cc0bbe7ec3.png"><img src="https://newbbs.bingyan.net/photo/2017/7cf14189dab4a369d923e5cc0bbe7ec3.png" alt="img"></a></p>
<ul>
<li>点击chunks，可以看到所有chunks的描述，左边是chunks的id，然后有namse，有多少modules，大小，引用它的chunks是谁、即parents，假如我们需要分析id为1的chunk，只需要点击左边的id</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/552b024d9c5a522b4b06db3e203d2fde.png"><img src="https://newbbs.bingyan.net/photo/2017/552b024d9c5a522b4b06db3e203d2fde.png" alt="img"></a></p>
<ul>
<li>这里你可以看到更详细的信息，这里最重要的是两个，reasons是引用这个chunks的模块，modules是这个chunks所引用的modules。也就是模块之间的调用关系。<a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/2d8b9a3c1657a69daba4f95ed0632a6d.png"><img src="https://newbbs.bingyan.net/photo/2017/2d8b9a3c1657a69daba4f95ed0632a6d.png" alt="img"></a></li>
<li>这里你发现有一个模块不是你想要的modules，你只需要点击这个模块的id，再去查看reasons就可以看到这个模块是被谁引入的。</li>
<li>也可点击上面的导航来看其他角度的分析。</li>
</ul>
<h1 id="更少的代码"><a href="#更少的代码" class="headerlink" title="更少的代码"></a>更少的代码</h1><h2 id="选择合适的框架和库"><a href="#选择合适的框架和库" class="headerlink" title="选择合适的框架和库"></a>选择合适的框架和库</h2><p>不是每次开发都要Vue或者React的……</p>
<ul>
<li>【Tips】Zepto是迷你版jQuery</li>
<li>【Tips】有时候写原生JavaScript也不是一个太差的主意</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/1e78c08c004c9454cbd0d480c405c7aa.png"><img src="https://newbbs.bingyan.net/photo/2017/1e78c08c004c9454cbd0d480c405c7aa.png" alt="img"></a></p>
<h2 id="试试JS模板引擎"><a href="#试试JS模板引擎" class="headerlink" title="试试JS模板引擎"></a>试试JS模板引擎</h2><p>2012年左右流行的模板引擎虽然在目前被普遍认为是一种被淘汰的技术，但是其数据驱动的思想还是值得我们借鉴的，例如它的思想实现数据逻辑和渲染逻辑的解耦，甚至你自己也可以写一个微型的模板渲染器。</p>
<p>相比主流的的MV*框架，它小巧快速，而这也是这本文所追求的。但是它没有组件的概念，不利于复用和解耦，也不用VirtualDOM技术。所以，简而言之，做一些小规模的、不大变动的数据渲染还是是很合适的。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/abd18bee7e0b9ae48812281fae69adbd.png"><img src="https://newbbs.bingyan.net/photo/2017/abd18bee7e0b9ae48812281fae69adbd.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/f936c9fbbf009c57081e0eddb937ec71.png"><img src="https://newbbs.bingyan.net/photo/2017/f936c9fbbf009c57081e0eddb937ec71.png" alt="img"></a></p>
<h2 id="精简版框架"><a href="#精简版框架" class="headerlink" title="精简版框架"></a>精简版框架</h2><p>Vue是比较小巧的，而React就不是了。这里推荐两个React精简替代品。我现在使用的是React-Lite，和React的API完美兼容。更换以来到目前也没有遇到什么问题。如果你的项目只是用React常见的API，直接换用React Lite会是个好主意。另一款，Preact，我还没有用过，这里留个坑，以后可以尝试一波。</p>
<table>
<thead>
<tr>
<th></th>
<th>React Lite</th>
<th>Preact</th>
</tr>
</thead>
<tbody>
<tr>
<td>API</td>
<td>兼容React API</td>
<td>类似React的API</td>
</tr>
<tr>
<td>使用体验</td>
<td>前段时间换用 开发环境暂时没发现问题</td>
<td>还没用过</td>
</tr>
<tr>
<td></td>
<td>去掉不常用的功能（例如服务器渲染）</td>
<td>类似React的实现</td>
</tr>
</tbody>
</table>
<h2 id="删去多余的模块"><a href="#删去多余的模块" class="headerlink" title="删去多余的模块"></a>删去多余的模块</h2><ul>
<li>去除不必要的Pollify。包括Babel的配置项和引入的模块（如Promise库、Fetch库）</li>
<li>寻找轻量的替代品，不要杀鸡用核弹。问一下自己：现在用的库可以换成更加轻量的吗？</li>
<li>避免为使用部分功能而引入整个模块。目前大型UI库、EChart等都提供了部分导入的用法，即只导入自己需要的那一部分而不是导入完整的库。具体用法参考它们的API文档。</li>
</ul>
<h2 id="善用代码分离"><a href="#善用代码分离" class="headerlink" title="善用代码分离"></a>善用代码分离</h2><p>代码分离到多个文件会增加HTTP请求的数目和大小，但可以充分利用浏览器的缓存和文件并行下载功能。这不会减小文件体积，却会给用户一种变快了的感觉。只要不是把文件拆得太零碎，利还是大于弊的。</p>
<p><em>此处假定你已经会使用CommonChunkPlugin、DLL等插件了。</em></p>
<h3 id="针对多页应用的三级分割"><a href="#针对多页应用的三级分割" class="headerlink" title="针对多页应用的三级分割"></a>针对多页应用的三级分割</h3><p>看到网上两级分割的做法，我提出了另一种策略。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/6f771c0d69ce8a5767ea62430328f1ea.png"><img src="https://newbbs.bingyan.net/photo/2017/6f771c0d69ce8a5767ea62430328f1ea.png" alt="img"></a></p>
<p>在配置文件里面，你可以像下图这么写，还有些要注意的地方。强烈建议大家好好看看CommonChunk插件的配置选项和官方例子—— <strong>CommonChunk的灵活程度超乎你的想象</strong> 。</p>
<p><a target="_blank" rel="noopener" href="https://newbbs.bingyan.net/photo/2017/e865b3cc95ea8f05018262a220604bb7.png"><img src="https://newbbs.bingyan.net/photo/2017/e865b3cc95ea8f05018262a220604bb7.png" alt="img"></a></p>
<h3 id="输出文件名使用-“chunkhash”"><a href="#输出文件名使用-“chunkhash”" class="headerlink" title="输出文件名使用 “chunkhash”"></a>输出文件名使用 “chunkhash”</h3><p>[chunkhash]会根据文件内容生成唯一哈希值，而[hash]根据module.id生成</p>
<p>在Webpack不同版本中，可能会遇到仅仅是module.id变化导致chunkhash变化的问题。解决方案是使用插件，参看WP官方文档-&gt;指南-&gt;缓存。</p>
<h1 id="压缩图片"><a href="#压缩图片" class="headerlink" title="压缩图片"></a>压缩图片</h1><p><strong>【位　图】</strong>：最低要求是上线之前顺手TinyPNG，可以很方便的批量上传下载，就是速度慢了点。也有其他的开源图片压缩工具，可以方便对接Webpack，但根据网上大佬的测试，压缩率不如TinyPNG高。</p>
<p>有时间的话，也可以尝试利用TinyPNG提供的接口把图片压缩操作放入生产环境构建过程中，实现build即最小。</p>
<p><strong>【矢量图】</strong>：单从减小文件体积来说，请多用矢量图，尤其对于大尺寸线条风格icon！在矢量图库里面找一找，或者用大Mac上的Sketch画一个也可以（是的，我就是这么干的）。</p>
<p>不知道有没有设计师小姐姐看到了这段话。</p>
<h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>我们的目标是向着更快的包进发！！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/03/01/%E6%8C%87%E5%8D%97%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%A9Webpack%E5%8C%85%E5%8A%A0%E8%BD%BD%E5%BE%97%E6%9B%B4%E5%BF%AB/" data-id="cklt0yx5p000ch4ssb7m84vci" data-title="指南：如何让Webpack包加载得更快" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Context/" rel="tag">Context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flex/" rel="tag">Flex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blend-mode/" rel="tag">blend mode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mask/" rel="tag">mask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" rel="tag">发布订阅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" rel="tag">开发工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/" rel="tag">混合模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%95%82%E7%A9%BA/" rel="tag">镂空</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 20px;">CSS</a> <a href="/tags/Context/" style="font-size: 10px;">Context</a> <a href="/tags/Flex/" style="font-size: 10px;">Flex</a> <a href="/tags/Git/" style="font-size: 20px;">Git</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/blend-mode/" style="font-size: 10px;">blend mode</a> <a href="/tags/mask/" style="font-size: 10px;">mask</a> <a href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" style="font-size: 10px;">发布订阅</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 10px;">密码学</a> <a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">开发工具</a> <a href="/tags/%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">混合模式</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E9%95%82%E7%A9%BA/" style="font-size: 10px;">镂空</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/03/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/02/22/%E7%94%A8%E7%BA%AFCSS%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C/">用纯 CSS 实现镂空效果</a>
          </li>
        
          <li>
            <a href="/2019/01/11/%E5%89%96%E6%9E%90-HTTPS-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">剖析 HTTPS 的设计思路</a>
          </li>
        
          <li>
            <a href="/2018/11/18/Pro-Git-Reading-Note-Part-II/">Pro Git Reading Note Part II</a>
          </li>
        
          <li>
            <a href="/2018/10/18/Pro-Git-Reading-Note-Part-I/">Pro Git Reading Note Part I</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Cattle<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>