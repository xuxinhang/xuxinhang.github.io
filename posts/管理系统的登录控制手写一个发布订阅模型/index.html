<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>管理系统的登录控制？手写一个发布订阅模型！ - 小牛写字的地方</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="管理系统的登录控制？手写一个发布订阅模型！"><meta property="og:description" content="最近做了一个后台的项目，既然是后台管理系统，登录的控制自然是少不了的。
接到需求——后台系统！花了几乎半天搞出来了Webpack配置、搞出来了React  Router、搞出来了 React  代码基本的结构，下一步就是搞所谓的“登录逻辑”了。
正好 React v16 大变，而自己最近又有些时候没写过React了，便不妨借这次机会熟悉一下React的新API吧！听说React新出的 Context API 可以“取代Redux”，那这次登录逻辑就用 Context 写吧！"><meta property="og:type" content="article"><meta property="og:url" content="http://xuxinhang.github.io/posts/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-17T23:10:16+00:00"><meta property="article:modified_time" content="2018-10-17T23:10:16+00:00"><meta itemprop=name content="管理系统的登录控制？手写一个发布订阅模型！"><meta itemprop=description content="最近做了一个后台的项目，既然是后台管理系统，登录的控制自然是少不了的。
接到需求——后台系统！花了几乎半天搞出来了Webpack配置、搞出来了React  Router、搞出来了 React  代码基本的结构，下一步就是搞所谓的“登录逻辑”了。
正好 React v16 大变，而自己最近又有些时候没写过React了，便不妨借这次机会熟悉一下React的新API吧！听说React新出的 Context API 可以“取代Redux”，那这次登录逻辑就用 Context 写吧！"><meta itemprop=datePublished content="2018-10-17T23:10:16+00:00"><meta itemprop=dateModified content="2018-10-17T23:10:16+00:00"><meta itemprop=wordCount content="697"><meta itemprop=keywords content="发布订阅,设计模式,React,Context,"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=小牛写字的地方 rel=home><div class="logo__item logo__text"><div class=logo__title>小牛写字的地方</div><div class=logo__tagline>专属小牛的写字工作区</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>文章</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于我</span></a></li><li class=menu__item><a class=menu__link href=https://github.com/xuxinhang><span class=menu__text>GitHub</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>管理系统的登录控制？手写一个发布订阅模型！</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>小牛</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-10-17T23:10:16Z>2018-10-17</time></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#根组件里的-react-context-来传递登录状态>根组件里的 React Context 来传递登录状态</a></li><li><a href=#唠叨几句我眼中管理系统的登录功能要有的功能点>唠叨几句：（我眼中）管理系统的登录功能要有的功能点</a></li><li><a href=#把逻辑提取出来>把逻辑提取出来</a><ul><li><a href=#全局访问>全局访问</a></li><li><a href=#处处同步发布订阅>处处同步（发布订阅）</a></li><li><a href=#代码>代码</a></li></ul></li><li><a href=#如何使用它>如何使用它？</a><ul><li><a href=#注入-react>注入 React</a></li></ul></li><li><a href=#顺便一提登录弹框>顺便一提：登录弹框</a></li><li><a href=#todo>TODO</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>最近做了一个后台的项目，既然是后台管理系统，登录的控制自然是少不了的。</p><p>接到需求——后台系统！花了几乎半天搞出来了Webpack配置、搞出来了React Router、搞出来了 React 代码基本的结构，下一步就是搞所谓的“登录逻辑”了。</p><p>正好 React v16 大变，而自己最近又有些时候没写过React了，便不妨借这次机会熟悉一下React的新API吧！听说React新出的 Context API 可以“取代Redux”，那这次登录逻辑就用 Context 写吧！</p><h2 id=根组件里的-react-context-来传递登录状态>根组件里的 React Context 来传递登录状态</h2><p>虽然离开React有些时日了，但是它新的 Context API 看起来还是很“美味”的。于是，三两下，一套 Context 就出现在了入口文件里：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// 登录之前的默认登录信息
</span><span style=color:#75715e>// 在可以看到我设计的“登录信息”的数据结构和内容
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>defaultLoginInfo</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
  <span style=color:#a6e22e>token</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
  <span style=color:#a6e22e>ident</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, 
};

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
    <span style=color:#75715e>// 写登录信息到 this.state
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 通过 toStore 判断是否也要写 Storage
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLogin</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>info</span>, <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>) =&gt; {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>prevState</span> =&gt; {
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>nv</span> <span style=color:#f92672>=</span> {...<span style=color:#a6e22e>prevState</span>.<span style=color:#a6e22e>userLoginInfo</span>, ...<span style=color:#a6e22e>info</span>};
        <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>storeLoginInfo</span>(<span style=color:#a6e22e>nv</span>);
        <span style=color:#66d9ef>return</span> {<span style=color:#a6e22e>userLoginInfo</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>nv</span>};
      });
    };

    <span style=color:#75715e>// 从 sesionStorage 中取回登录信息
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span> <span style=color:#f92672>=</span> () =&gt; {
      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>stored</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sessionStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;userLoginInfo&#39;</span>);
      <span style=color:#75715e>// 这里需要一个 try ... catch ...  ，但是为了代码易读我给删除了
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>stored</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>stored</span>) <span style=color:#f92672>:</span> {};
    };
    
    <span style=color:#75715e>// 将登录信息存入 Storage
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>storeLoginInfo</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>val</span>) =&gt; {
      <span style=color:#a6e22e>sessionStorage</span>.<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;userLoginInfo&#39;</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>val</span>));
    };

    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
      <span style=color:#a6e22e>userLoginInfo</span><span style=color:#f92672>:</span> {
        ...<span style=color:#a6e22e>defaultLoginInfo</span>,
        <span style=color:#a6e22e>update</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLogin</span>,   <span style=color:#75715e>// 向子组件暴露方法
</span><span style=color:#75715e></span>        <span style=color:#75715e>// 在主组件初绐化时通过覆盖默认登录信息来生成实际用的登录信息
</span><span style=color:#75715e></span>        ...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span>(),
        <span style=color:#a6e22e>exit</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLogin</span>({...<span style=color:#a6e22e>defaultLoginInfo</span>}), <span style=color:#75715e>// 向子组件暴露方法 - 退出登录
</span><span style=color:#75715e></span>      },
    };
  }

  <span style=color:#a6e22e>render</span>() {} <span style=color:#75715e>// .....
</span><span style=color:#75715e></span>
  <span style=color:#a6e22e>componentDidMount</span>() {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLogin</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span>(), <span style=color:#66d9ef>false</span>);
  }
}

</code></pre></div><p>可以说是很简陋了——这就是我用Context API 替代 Redux 的第一个作品。但它很简明，也工作得很好——直到我想为登录部分加些新想法……</p><h2 id=唠叨几句我眼中管理系统的登录功能要有的功能点>唠叨几句：（我眼中）管理系统的登录功能要有的功能点</h2><ol><li>登录状态持久化。什么用户权限啊，身份啊，token啊，都要存到 Storage 里面。</li><li>登录状态全局可访问，包括在 React 组件以外。</li><li>Storage 丢失后有提示，引导用户重新登录。</li><li>引导重新登录不可使用页面跳转，可以使用弹框。（想像一下：用户填完了一大堆表单，可是程序检测到登录失效给跳转了……）</li></ol><p>从这几点出发来看，原来的代码在 React 组件之外，一无是处……</p><h2 id=把逻辑提取出来>把逻辑提取出来</h2><h3 id=全局访问>全局访问</h3><p>那就把代码放到全局呗……</p><p>window 对象？（有这种想法的同学请面壁思过）</p><p>那么如何避免使用全局变量又能解决数据存储的问题呢？那就是是“沙盒模式”。沙盒模式，是JS非常普遍的一个设计模式，它通过闭包的原理将数据维持在一个函数作用于中，而通过返回值内的函数引用这个函数包体内的变量的方式，形成闭包，而只有通过该函数的返回函数才能访问和修改该闭包内的数据，从而起来了数据保护的作用。</p><p>嗯，又是那个叫“闭包”的玩意。</p><p>但是，我们现在有了“模块化”。当我们 <code>import</code> 一个模块的时候，这个模块的声明会保持在一个独立的作用域中，且一直存在。可以使用 <code>exports</code> 来实现“沙盒”的效果。除了导出的函数，其它对外界都不可见。（话说 Webpack 的模块不也是用闭包来实现的吗？）</p><h3 id=处处同步发布订阅>处处同步（发布订阅）</h3><p>分析一下：</p><p>哪里需要发布？</p><ul><li>“退出登录”按钮</li><li>后端 API 告诉我“登录信息不对”</li><li>前端主动发现登录信息损坏</li></ul><p>哪里需要订阅？</p><ul><li>UI ， 也就是根组件的 state</li></ul><p>明显，发布订阅是合适的。</p><h3 id=代码>代码</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// 登录过期检测
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>checkExpireTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>info</span> =&gt; {
  <span style=color:#66d9ef>return</span> Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>expireTime</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>expireTime</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>;
};

<span style=color:#75715e>// 负责 Storage 操作：取回 + 存入
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>retrieveLoginInfo</span>() {
  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>stored</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sessionStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;userLoginInfo&#39;</span>);
  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>stored</span>) {
    <span style=color:#66d9ef>try</span> {
      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>info</span> <span style=color:#f92672>=</span> { ...<span style=color:#a6e22e>defaultLoginInfo</span>, ...<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>stored</span>) };
      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>checkExpireTime</span>(<span style=color:#a6e22e>info</span>) <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>token</span>) {
        <span style=color:#a6e22e>exitLogin</span>();
        <span style=color:#66d9ef>return</span> {...<span style=color:#a6e22e>defaultLoginInfo</span>};
      }
      <span style=color:#66d9ef>return</span> {...<span style=color:#a6e22e>defaultLoginInfo</span>, ...<span style=color:#a6e22e>info</span>};
    } <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>e</span>) {
      <span style=color:#66d9ef>return</span> {...<span style=color:#a6e22e>defaultLoginInfo</span>};
    }
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#a6e22e>exitLogin</span>();
    <span style=color:#66d9ef>return</span> {...<span style=color:#a6e22e>defaultLoginInfo</span>};
  }
}
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>storeLoginInfo</span>(<span style=color:#a6e22e>val</span>) {
  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sessionStorage</span>.<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;userLoginInfo&#39;</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>val</span>));
}

<span style=color:#75715e>// 广播
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>broadcastLoginInfo</span>(<span style=color:#a6e22e>info</span>) {
  <span style=color:#a6e22e>broadcastList</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>curt</span> =&gt; {
    <span style=color:#a6e22e>curt</span>(<span style=color:#a6e22e>info</span>);
  });
}
<span style=color:#75715e>// 存放 Listener
</span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>broadcastList</span> <span style=color:#f92672>=</span> [];
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>registerLoginInfoBroadcast</span>(<span style=color:#a6e22e>callback</span>) {
  <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>broadcastList</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>callback</span>)) {
    <span style=color:#a6e22e>broadcastList</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>callback</span>);
  }
}

<span style=color:#75715e>// 更新登录信息 - 类似 Dispacher
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateLoginInfo</span>(<span style=color:#a6e22e>info</span>) {
  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>checkExpireTime</span>(<span style=color:#a6e22e>info</span>)) {
    <span style=color:#a6e22e>exitLogin</span>();
    <span style=color:#66d9ef>return</span> [<span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#39;登录过期，请重新登录&#39;</span>];
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#a6e22e>storeLoginInfo</span>(<span style=color:#a6e22e>info</span>);
    <span style=color:#a6e22e>broadcastLoginInfo</span>(<span style=color:#a6e22e>info</span>);
    <span style=color:#66d9ef>return</span> [<span style=color:#66d9ef>true</span>];
  }
}

<span style=color:#75715e>// 一些常用动作的提取（我们要拒绝样本代码）
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>exitLogin</span>() {
  <span style=color:#a6e22e>updateLoginInfo</span>({...<span style=color:#a6e22e>defaultLoginInfo</span>});
}
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>syncLoginInfo</span>() {
  <span style=color:#a6e22e>broadcastLoginInfo</span>(<span style=color:#a6e22e>retrieveLoginInfo</span>());
}

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> { 
  <span style=color:#a6e22e>update</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>updateLoginInfo</span>,
  <span style=color:#a6e22e>retrieve</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>retrieveLoginInfo</span>,
  <span style=color:#a6e22e>exit</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>exitLogin</span>,
  <span style=color:#a6e22e>registerBroadcast</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>registerLoginInfoBroadcast</span>,
  <span style=color:#a6e22e>sync</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>syncLoginInfo</span>,
  <span style=color:#a6e22e>storeLoginInfo</span>,
  <span style=color:#a6e22e>retrieveLoginInfo</span>,
  <span style=color:#a6e22e>defaultLoginInfo</span>,
};

</code></pre></div><h2 id=如何使用它>如何使用它？</h2><p>比如说，后台检测到 Token 错误，想强行清空登录信息，要怎么操作？</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>loginInfo</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@/utils/path/to/loginInfoStorage.js&#39;</span>;
<span style=color:#75715e>// ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>RequestApi</span> (<span style=color:#a6e22e>respData</span>) {
    <span style=color:#75715e>// Do some processing
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>([<span style=color:#ae81ff>301</span>, <span style=color:#ae81ff>302</span>, <span style=color:#ae81ff>303</span>].<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>respData</span>.<span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>code</span>) <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
        <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>exit</span>(); <span style=color:#75715e>// 登录出错？要自行退出登录！
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>至于 React 根组件里，情况就有些复杂了……</p><h3 id=注入-react>注入 React</h3><p>在根组件里：</p><p>要记得 Register Listener</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// 放在 constructor 或者 componentDidMounted 里都好 
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>registerBroadcast</span>(<span style=color:#a6e22e>info</span> =&gt; {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginState</span>(<span style=color:#a6e22e>info</span>, <span style=color:#66d9ef>false</span>);
    });
</code></pre></div><p>Listener 触发时要更新根组件的 State</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginState</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>info</span>, <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>) =&gt; {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>prevState</span> =&gt; {
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>nv</span> <span style=color:#f92672>=</span> {...<span style=color:#a6e22e>prevState</span>.<span style=color:#a6e22e>userLoginInfo</span>, ...<span style=color:#a6e22e>info</span>};
        <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>storeLoginInfo</span>(<span style=color:#a6e22e>nv</span>);
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newState</span> <span style=color:#f92672>=</span> {};
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>prevState</span>.<span style=color:#a6e22e>useLoginModal</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>nv</span>.<span style=color:#a6e22e>token</span>) {
          <span style=color:#a6e22e>newState</span>.<span style=color:#a6e22e>userLoginInfo</span> <span style=color:#f92672>=</span> {...<span style=color:#a6e22e>nv</span>};
        }
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>newState</span>;
      });
    };
</code></pre></div><p>随 Context 传给子组件的函数也不能忘</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
      <span style=color:#a6e22e>userLoginInfo</span><span style=color:#f92672>:</span> {
        ...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span>(),
        <span style=color:#a6e22e>update</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginInfo</span>,
        <span style=color:#a6e22e>exit</span><span style=color:#f92672>:</span> () =&gt; {
            <span style=color:#75715e>// 还有其它功能
</span><span style=color:#75715e></span>            <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>exit</span>();
        },
      },
    };
</code></pre></div><p>为了突出本质，以上只是我简化后的代码。完整的代码（见下文）还有登录弹框等功能。</p><p><strong>注意</strong></p><ul><li>作为订阅者，Listener 里不要再调用 update（发布者） （令我想起了 componentDidUpdate）</li></ul><h2 id=顺便一提登录弹框>顺便一提：登录弹框</h2><p>本来不是本文讨论范围，但这里也让我颇费心思，实现得也不很好。此处不妨讲讲。</p><blockquote><p>Storage 丢失后有提示，引导用户重新登录。引导重新登录不可使用页面跳转，可以使用弹框。</p></blockquote><p>一个棘手的问题是，框可以弹出来，但框背后的管理界面UI不能变。</p><p>我的思路是：state 里的 loginInfo 分两种——真实反映实际登录状态的 actualLoginInfo 和为UI专供的 userLoginInfo。React router 和其它UI组件的 render 根据 userLoginInfo 来做判断和渲染，登录弹框则使用 actualLoginInfo。
下面就是我实际使用的代码了。只是这个思路很不优雅。</p><p>注意的几点：</p><ol><li><code>useLoginModal</code> - 使用登录弹框还是路由跳转到一整个登录页？</li><li>未登录且<code>useLoginModal</code> 为 true 时显示登录弹窗</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);

    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginState</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>info</span>, <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>) =&gt; {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>prevState</span> =&gt; {
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>nv</span> <span style=color:#f92672>=</span> {...<span style=color:#a6e22e>prevState</span>.<span style=color:#a6e22e>userLoginInfo</span>, ...<span style=color:#a6e22e>info</span>};
        <span style=color:#a6e22e>toStore</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>storeLoginInfo</span>(<span style=color:#a6e22e>nv</span>);
        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newState</span> <span style=color:#f92672>=</span> {
          <span style=color:#a6e22e>actualLoginInfo</span><span style=color:#f92672>:</span> {...<span style=color:#a6e22e>nv</span>},
        };
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>prevState</span>.<span style=color:#a6e22e>useLoginModal</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>nv</span>.<span style=color:#a6e22e>token</span>) {
          <span style=color:#a6e22e>newState</span>.<span style=color:#a6e22e>userLoginInfo</span> <span style=color:#f92672>=</span> {...<span style=color:#a6e22e>nv</span>};
          <span style=color:#a6e22e>newState</span>.<span style=color:#a6e22e>useLoginModal</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!!</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>token</span>; <span style=color:#75715e>// 登录后默认使用登录弹窗
</span><span style=color:#75715e></span>        }
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>newState</span>;
      });
    };

    <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>registerBroadcast</span>(<span style=color:#a6e22e>info</span> =&gt; {
      <span style=color:#75715e>// 显示登录弹窗就不修改登录相关的UI状态
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginState</span>(<span style=color:#a6e22e>info</span>, <span style=color:#66d9ef>false</span>);
    });

    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>retrieve</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginInfo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>update</span>;
    
    <span style=color:#75715e>// [NOTE] 需要在渲染&lt;Route&gt;之前读入登录状态
</span><span style=color:#75715e></span>    <span style=color:#75715e>//        否则刷新之后URL会因为Route未渲染而丢失
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
      <span style=color:#a6e22e>userLoginInfo</span><span style=color:#f92672>:</span> {
        ...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>retrieveLoginInfo</span>(),
        <span style=color:#75715e>// 升级登录信息
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>update</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateLoginInfo</span>,
        <span style=color:#75715e>// 在UI中使用此函数来退出登录
</span><span style=color:#75715e></span>        <span style=color:#75715e>// config.useLoginModal
</span><span style=color:#75715e></span>        <span style=color:#75715e>//   - true  改写登录状态、不修改登录相关的UI状态、显示登录弹窗
</span><span style=color:#75715e></span>        <span style=color:#75715e>//   - false 改写登录状态、修改登录相关的UI状态、回到登录页面
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>exit</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {}) =&gt; {
          <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>useLoginModal</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>false</span>) {
            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({
              <span style=color:#a6e22e>useLoginModal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
            }, () =&gt; {
              <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>exit</span>();
            });
          } <span style=color:#66d9ef>else</span> {
            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({
              <span style=color:#a6e22e>useLoginModal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
            }, () =&gt; {
              <span style=color:#a6e22e>loginInfo</span>.<span style=color:#a6e22e>exit</span>();
            });
          }
        },
      },
      <span style=color:#a6e22e>useLoginModal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
      <span style=color:#a6e22e>actualLoginInfo</span><span style=color:#f92672>:</span> {},
    };
    
  <span style=color:#a6e22e>render</span>() {
    <span style=color:#66d9ef>return</span> (
      <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>UserCtx</span>.<span style=color:#a6e22e>Provider</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>userLoginInfo</span>}<span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>UserCtx</span>.<span style=color:#a6e22e>Consumer</span><span style=color:#f92672>&gt;</span>
        {<span style=color:#a6e22e>info</span> =&gt; (
          <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>main</span> <span style=color:#a6e22e>styleName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;main-container&#34;</span><span style=color:#f92672>&gt;</span>
            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>HashRouter</span><span style=color:#f92672>&gt;</span>
              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>LocaleProvider</span> <span style=color:#a6e22e>locale</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>zh_CN</span>}<span style=color:#f92672>&gt;</span>
                <span style=color:#f92672>&lt;&gt;</span>
                  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Switch</span><span style=color:#f92672>&gt;</span>
                    {(<span style=color:#f92672>!</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>token</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/login&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>withRouterLogin</span>} <span style=color:#f92672>/&gt;</span>}
                    {<span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>token</span>    <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Route</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/admin&#34;</span> <span style=color:#a6e22e>component</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>withRouterAdmin</span>} <span style=color:#f92672>/&gt;</span>}
                    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Redirect</span> <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>token</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;/admin&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/login&#39;</span>} <span style=color:#f92672>/&gt;</span>
                  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Switch&gt;</span>
                <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/&gt;</span>
              <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/LocaleProvider&gt;</span>
            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/HashRouter&gt;</span>
            {<span style=color:#75715e>/* 未登录且useLoginModal时显示登录弹窗 */</span>}
            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Modal</span>
              <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;请先登录账户&#34;</span>
              <span style=color:#a6e22e>visible</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>useLoginModal</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>actualLoginInfo</span>.<span style=color:#a6e22e>token</span>}
              <span style=color:#a6e22e>footer</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>false</span>}
              <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span>{<span style=color:#ae81ff>370</span>}
              <span style=color:#a6e22e>closable</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>false</span>}
            <span style=color:#f92672>&gt;</span>
              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>LoginForm</span> <span style=color:#f92672>/&gt;</span>
            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Modal&gt;</span>
          <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/main&gt;</span>
        )}
        <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/UserCtx.Consumer&gt;</span>
      <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/UserCtx.Provider&gt;</span>
    );
  }
    
<span style=color:#960050;background-color:#1e0010>｝</span>
</code></pre></div><h2 id=todo>TODO</h2><p>很多地方还有待完善：</p><ul><li>每次都要去 Storage.get！ 可以加个缓存吗？</li><li>可以封装成一个类或者构造函数？这样更加通用！</li><li>还没写取消 Listener 的功能……</li></ul><h2 id=总结>总结</h2><p>我这个前端小菜狗就是这样在不知不觉中把登录部分的代码抽象出来了一套发布订阅模型。</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/ rel=tag>发布订阅</a></li><li class=tags__item><a class="tags__link btn" href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ rel=tag>设计模式</a></li><li class=tags__item><a class="tags__link btn" href=/tags/react/ rel=tag>React</a></li><li class=tags__item><a class="tags__link btn" href=/tags/context/ rel=tag>Context</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="小牛 avatar" src=/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About 小牛</span></div><div class=authorbox__description>就只是一只小牛而已</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/%E5%85%B3%E4%BA%8Epromise%E7%9A%84%E5%87%A0%E4%B8%AAtips/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>关于Promise的几个Tips</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/pro-git-tips/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Pro Git Tips</p></a></div></nav></div><aside class="sidebar sidebar--left"><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=SEARCH… name=q aria-label=SEARCH…></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=http://xuxinhang.github.io/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/%E4%BD%BF%E7%94%A8tex%E7%9B%92%E5%AD%90%E7%9A%84%E4%B8%A4%E4%B8%AA%E4%BE%8B%E5%AD%90/>使用 TeX 盒子的两个例子</a></li><li class=widget__item><a class=widget__link href=/posts/%E6%9D%82%E8%B0%88%E6%80%8E%E6%A0%B7%E6%95%B4%E7%90%86%E5%90%84%E5%BC%8F%E5%90%84%E6%A0%B7%E7%9A%84%E4%B8%AA%E4%BA%BA%E6%96%87%E4%BB%B6/>杂谈：怎样整理各式各样的个人文件？</a></li><li class=widget__item><a class=widget__link href=/posts/%E6%80%8E%E6%A0%B7%E8%88%92%E9%80%82%E5%9C%B0%E4%BD%BF%E7%94%A8vim%E7%A0%81%E5%AD%97%E5%86%99%E6%96%87%E7%AB%A0/>怎样舒适地使用 Vim 码字写文章</a></li><li class=widget__item><a class=widget__link href=/posts/latex%E5%85%A5%E9%97%A8%E5%B0%8F%E8%AE%B0vim+vimtex+latex%E5%88%9D%E4%BD%93%E9%AA%8C/>LaTeX 入门小记：Vim + Vimtex + LaTeX 初体验</a></li><li class=widget__item><a class=widget__link href=/posts/%E7%94%A8%E7%BA%AFcss%E5%AE%9E%E7%8E%B0%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C/>用纯 CSS 实现镂空效果</a></li><li class=widget__item><a class=widget__link href=/posts/%E4%BD%BF%E7%94%A8heroku%E6%88%96openshift%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%85%8D%E8%B4%B9%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91v2ray%E6%9C%8D%E5%8A%A1/>使用 Heroku 或 OpenShift 搭建自己的免费科学上网 V2Ray 服务</a></li><li class=widget__item><a class=widget__link href=/posts/%E5%89%96%E6%9E%90-https-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/>剖析 HTTPS 的设计思路</a></li><li class=widget__item><a class=widget__link href=/posts/pro-git-tips/>Pro Git Tips</a></li><li class=widget__item><a class=widget__link href=/posts/%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A7%E5%88%B6%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B/>管理系统的登录控制？手写一个发布订阅模型！</a></li><li class=widget__item><a class=widget__link href=/posts/%E5%85%B3%E4%BA%8Epromise%E7%9A%84%E5%87%A0%E4%B8%AAtips/>关于Promise的几个Tips</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/latex/>LaTeX</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/blend-mode/ title="blend mode">blend mode</a>
<a class="widget-taglist__link widget__link btn" href=/tags/context/ title=Context>Context</a>
<a class="widget-taglist__link widget__link btn" href=/tags/css/ title=CSS>CSS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/flex/ title=Flex>Flex</a>
<a class="widget-taglist__link widget__link btn" href=/tags/git/ title=Git>Git</a>
<a class="widget-taglist__link widget__link btn" href=/tags/https/ title=HTTPS>HTTPS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=Javascript>Javascript</a>
<a class="widget-taglist__link widget__link btn" href=/tags/latex/ title=LaTeX>LaTeX</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mask/ title=mask>mask</a>
<a class="widget-taglist__link widget__link btn" href=/tags/promise/ title=Promise>Promise</a>
<a class="widget-taglist__link widget__link btn" href=/tags/react/ title=React>React</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ssh/ title=SSH>SSH</a>
<a class="widget-taglist__link widget__link btn" href=/tags/v2ray/ title=V2Ray>V2Ray</a>
<a class="widget-taglist__link widget__link btn" href=/tags/vim/ title=Vim>Vim</a>
<a class="widget-taglist__link widget__link btn" href=/tags/webpack/ title=Webpack>Webpack</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/ title=发布订阅>发布订阅</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/ title=密码学>密码学</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ title=开发工具>开发工具</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/ title=混合模式>混合模式</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/ title=科学上网>科学上网</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ title=设计模式>设计模式</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%95%82%E7%A9%BA/ title=镂空>镂空</a></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 xuxinhang.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src=/js/custom.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>